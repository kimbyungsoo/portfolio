"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.loadClass = loadClass;
Object.defineProperty(exports, "clearCache", {
  enumerable: true,
  get: function () {
    return _typesCache.clearCache;
  }
});
exports.ParseClass = void 0;

var _execute = require("./execute");

var _graphql = require("graphql");

var _types = require("./types");

var _Node = require("./types/Node");

var _ParseObject = require("./types/ParseObject");

var _typesCache = require("./typesCache");

function handleIdField(fieldName) {
  if (fieldName === 'objectId' || fieldName == 'id') {
    return new _graphql.GraphQLNonNull(_graphql.GraphQLID);
  }
}

function getRelationField(fieldName, field, schema) {
  if (field.type == 'Relation') {
    const {
      find
    } = loadClass(field.targetClass, schema);

    find.resolve = async (parent, args, context, info) => {
      const query = {
        $relatedTo: {
          object: {
            __type: 'Pointer',
            className: parent.className,
            objectId: parent.objectId
          },
          key: fieldName
        }
      };
      args.redirectClassNameForKey = fieldName;
      const results = await (0, _execute.runFind)(context, info, parent.className, args, schema, query);
      return (0, _execute.connectionResultsArray)(results, args, 100);
    };

    return find;
  }
}

function graphQLField(fieldName, field, schema) {
  let gQLType = handleIdField(fieldName) || (0, _types.type)(field);

  if (!gQLType) {
    // If it's not possible to resovle a simple type
    // check if it's a proper relation field
    return getRelationField(fieldName, field, schema);
  }

  const fieldType = gQLType === _types.Pointer ? `Pointer<${field.targetClass}>` : `${field.type}`;
  let gQLResolve;

  if (field.type === 'Pointer') {
    gQLType = loadClass(field.targetClass, schema).objectType, gQLResolve = (parent, args, context, info) => {
      const object = parent[fieldName];
      const selections = info.fieldNodes[0].selectionSet.selections.map(field => {
        return field.name.value;
      });

      if (selections.indexOf('id') < 0 || selections.length > 1) {
        return (0, _execute.runGet)(context, info, object.className, object.objectId, schema);
      }

      return (0, _execute.transformResult)(field.targetClass, object, schema, {
        context,
        info
      });
    };
  }

  return {
    name: fieldName,
    type: gQLType,
    resolve: gQLResolve,
    description: `Accessor for ${fieldName} (${fieldType})`
  };
}

function graphQLInputField(fieldName, field) {
  const gQLType = handleIdField(fieldName) || (0, _types.inputType)(field);

  if (!gQLType) {
    return;
  }

  const fieldType = gQLType === _types.Pointer ? `Pointer<${field.targetClass}>` : `${field.type}`;
  return {
    name: fieldName,
    type: gQLType,
    description: `Setter for ${fieldName} (${fieldType})`
  };
}

function graphQLQueryField(fieldName, field, schema) {
  let gQLType = handleIdField(fieldName) || (0, _types.queryType)(field);

  if (!gQLType) {
    return;
  }

  if (field.type == 'Pointer') {
    gQLType = loadClass(field.targetClass, schema).queryType;
  }

  return {
    name: fieldName,
    type: gQLType,
    description: `Query for ${fieldName} (${field.type})`
  };
}

function transformInput(input, schema) {
  const {
    fields
  } = schema;
  Object.keys(input).forEach(key => {
    const value = input[key];

    if (fields[key] && fields[key].type === 'Pointer') {
      value.__type = 'Pointer';
    } else if (fields[key] && fields[key].type === 'GeoPoint') {
      value.__type = 'GeoPoint';
    }
  });
  return input;
}

function loadClass(className, schema) {
  const c = (0, _typesCache.getOrElse)(className, () => new ParseClass(className, schema));
  const objectType = c.graphQLObjectType();
  const inputType = c.graphQLInputObjectType();
  const updateType = c.graphQLUpdateInputObjectType();
  const queryType = c.graphQLQueryInputObjectType();
  const queryResultType = c.graphQLQueryResultType(objectType);
  const mutationResultType = c.graphQLMutationResultType(objectType);
  const get = {
    type: objectType,
    description: `Use this endpoint to get or query ${className} objects`,
    args: {
      objectId: {
        type: _graphql.GraphQLID
      }
    },
    resolve: async (root, args, context, info) => {
      // Get the selections
      return await (0, _execute.runGet)(context, info, className, args.objectId, schema);
    }
  };
  const find = {
    type: queryResultType,
    description: `Use this endpoint to get or query ${className} objects`,
    args: {
      where: {
        type: queryType
      },
      first: {
        type: _graphql.GraphQLInt
      },
      last: {
        type: _graphql.GraphQLInt
      },
      after: {
        type: _graphql.GraphQLString
      },
      before: {
        type: _graphql.GraphQLString
      }
    },
    resolve: async (root, args, context, info) => {
      // Get the selections
      const results = await (0, _execute.runFind)(context, info, className, args, schema);
      return (0, _execute.connectionResultsArray)(results, args, 100);
    }
  };
  const create = {
    type: mutationResultType,
    fields: objectType.fields,
    description: `use this method to create a new ${className}`,
    args: {
      input: {
        type: inputType
      }
    },
    resolve: async (root, args, context, info) => {
      const input = transformInput(args.input, schema[className]);
      const res = await _execute.rest.create(context.config, context.auth, className, input); // Run get to match graphQL style

      const object = await (0, _execute.runGet)(context, info, className, res.response.objectId);
      return {
        object
      };
    }
  };
  const update = {
    type: mutationResultType,
    description: `use this method to update an existing ${className}`,
    args: {
      input: {
        type: updateType
      }
    },
    resolve: async (root, args, context, info) => {
      if (!args.input.id && !args.input.objectId) {
        throw 'id or objectId are required';
      }

      let objectId;

      if (args.input.objectId) {
        objectId = args.input.objectId;
        delete args.input.objectId;
      } else {
        objectId = (0, _execute.parseID)(args.input.id).objectId;
        delete args.input.id;
      }

      const input = transformInput(args.input, schema[className]);
      await _execute.rest.update(context.config, context.auth, className, {
        objectId
      }, input); // Run get to match graphQL style

      const object = await (0, _execute.runGet)(context, info, className, objectId);
      return {
        object
      };
    }
  };
  const destroy = {
    type: mutationResultType,
    description: `use this method to update delete an existing ${className}`,
    args: {
      objectId: {
        type: new _graphql.GraphQLNonNull(_graphql.GraphQLID)
      }
    },
    resolve: async (root, args, context, info) => {
      const object = await (0, _execute.runGet)(context, info, className, args.objectId);
      await _execute.rest.del(context.config, context.auth, className, args.objectId);
      return {
        object
      };
    }
  };
  return {
    displayName: c.displayName,
    get,
    find,
    create,
    update,
    destroy,
    objectType,
    inputType,
    updateType,
    queryType,
    queryResultType,
    mutationResultType,
    class: c
  };
}

const reservedFieldNames = ['objectId', 'createdAt', 'updatedAt'];

class ParseClass {
  constructor(className, schema) {
    this.className = className;
    this.displayName = className;

    if (this.className.indexOf('_') === 0) {
      this.displayName = this.className.slice(1);
    }

    this.schema = schema;
    this.class = this.schema[className];
  }

  buildFields(mapper, filterReserved = false, isObject = false) {
    const fields = this.class.fields;
    const initial = {};

    if (isObject) {
      initial.id = {
        description: 'A globaly unique identifier.',
        type: new _graphql.GraphQLNonNull(_graphql.GraphQLID)
      };
    }

    return Object.keys(fields).reduce((memo, fieldName) => {
      if (filterReserved && reservedFieldNames.indexOf(fieldName) >= 0) {
        return memo;
      }

      const field = fields[fieldName];
      const gQLField = mapper(fieldName, field, this.schema);

      if (!gQLField) {
        return memo;
      }

      memo[fieldName] = gQLField;
      return memo;
    }, initial);
  }

  graphQLConfig() {
    const className = this.className;
    return {
      name: this.displayName,
      description: `Parse Class ${className}`,
      interfaces: [_Node.Node, _ParseObject.ParseObjectInterface],
      fields: () => this.buildFields(graphQLField, false, true),
      isTypeOf: a => {
        return a.className == className;
      }
    };
  }

  graphQLInputConfig() {
    const className = this.className;
    return {
      name: `Create${this.displayName}Input`,
      description: `Parse Class ${className} Input`,
      fields: () => {
        return this.buildFields(graphQLInputField, true);
      },
      isTypeOf: function (input) {
        return input.className == className;
      }
    };
  }

  graphQLQueryConfig() {
    const className = this.className;
    return {
      name: this.displayName + 'Query',
      description: `Parse Class ${className} Query`,
      fields: () => {
        const fields = this.buildFields(graphQLQueryField);
        delete fields.objectId;
        delete fields.id;
        return fields;
      },
      isTypeOf: function (input) {
        return input.className == className;
      }
    };
  }

  graphQLUpdateInputConfig() {
    return {
      name: `Update${this.displayName}Input`,
      description: `Parse Class ${this.className} Update`,
      fields: () => {
        const fields = this.buildFields(graphQLInputField, true);
        fields.id = {
          type: _graphql.GraphQLID
        };
        fields.objectId = {
          type: _graphql.GraphQLID
        };
        return fields;
      },
      isTypeOf: function (input) {
        return input.className == this.className;
      }
    };
  }

  graphQLQueryResultConfig() {
    const objectType = this.graphQLObjectType();
    return {
      name: `${this.displayName}QueryConnection`,
      fields: {
        nodes: {
          type: new _graphql.GraphQLList(objectType)
        },
        edges: {
          type: new _graphql.GraphQLList(new _graphql.GraphQLObjectType({
            name: `${this.className}Edge`,
            fields: () => ({
              node: {
                type: objectType
              },
              cursor: {
                type: _graphql.GraphQLString
              }
            })
          }))
        },
        pageInfo: {
          type: _types.PageInfo
        }
      }
    };
  }

  graphQLMutationResultConfig() {
    const objectType = this.graphQLObjectType();
    return {
      name: `${this.displayName}MutationCompletePayload`,
      fields: {
        object: {
          type: objectType
        },
        clientMutationId: {
          type: _graphql.GraphQLString
        }
      }
    };
  }

  graphQLObjectType() {
    if (!this.objectType) {
      this.objectType = new _graphql.GraphQLObjectType(this.graphQLConfig());
    }

    return this.objectType;
  }

  graphQLUpdateInputObjectType() {
    if (!this.updateInputObjectType) {
      this.updateInputObjectType = new _graphql.GraphQLInputObjectType(this.graphQLUpdateInputConfig());
    }

    return this.updateInputObjectType;
  }

  graphQLInputObjectType() {
    if (!this.inputObjectType) {
      this.inputObjectType = new _graphql.GraphQLInputObjectType(this.graphQLInputConfig());
    }

    return this.inputObjectType;
  }

  graphQLQueryInputObjectType() {
    if (!this.queryInputObjectType) {
      this.queryInputObjectType = new _graphql.GraphQLInputObjectType(this.graphQLQueryConfig());
    }

    return this.queryInputObjectType;
  }

  graphQLQueryResultType() {
    if (!this.queryResultObjectType) {
      this.queryResultObjectType = new _graphql.GraphQLObjectType(this.graphQLQueryResultConfig());
    }

    return this.queryResultObjectType;
  }

  graphQLMutationResultType() {
    if (!this.mutationResultObjectType) {
      this.mutationResultObjectType = new _graphql.GraphQLObjectType(this.graphQLMutationResultConfig());
    }

    return this.mutationResultObjectType;
  }

}

exports.ParseClass = ParseClass;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ncmFwaHFsL1BhcnNlQ2xhc3MuanMiXSwibmFtZXMiOlsiaGFuZGxlSWRGaWVsZCIsImZpZWxkTmFtZSIsIkdyYXBoUUxOb25OdWxsIiwiR3JhcGhRTElEIiwiZ2V0UmVsYXRpb25GaWVsZCIsImZpZWxkIiwic2NoZW1hIiwidHlwZSIsImZpbmQiLCJsb2FkQ2xhc3MiLCJ0YXJnZXRDbGFzcyIsInJlc29sdmUiLCJwYXJlbnQiLCJhcmdzIiwiY29udGV4dCIsImluZm8iLCJxdWVyeSIsIiRyZWxhdGVkVG8iLCJvYmplY3QiLCJfX3R5cGUiLCJjbGFzc05hbWUiLCJvYmplY3RJZCIsImtleSIsInJlZGlyZWN0Q2xhc3NOYW1lRm9yS2V5IiwicmVzdWx0cyIsImdyYXBoUUxGaWVsZCIsImdRTFR5cGUiLCJmaWVsZFR5cGUiLCJQb2ludGVyIiwiZ1FMUmVzb2x2ZSIsIm9iamVjdFR5cGUiLCJzZWxlY3Rpb25zIiwiZmllbGROb2RlcyIsInNlbGVjdGlvblNldCIsIm1hcCIsIm5hbWUiLCJ2YWx1ZSIsImluZGV4T2YiLCJsZW5ndGgiLCJkZXNjcmlwdGlvbiIsImdyYXBoUUxJbnB1dEZpZWxkIiwiZ3JhcGhRTFF1ZXJ5RmllbGQiLCJxdWVyeVR5cGUiLCJ0cmFuc2Zvcm1JbnB1dCIsImlucHV0IiwiZmllbGRzIiwiT2JqZWN0Iiwia2V5cyIsImZvckVhY2giLCJjIiwiUGFyc2VDbGFzcyIsImdyYXBoUUxPYmplY3RUeXBlIiwiaW5wdXRUeXBlIiwiZ3JhcGhRTElucHV0T2JqZWN0VHlwZSIsInVwZGF0ZVR5cGUiLCJncmFwaFFMVXBkYXRlSW5wdXRPYmplY3RUeXBlIiwiZ3JhcGhRTFF1ZXJ5SW5wdXRPYmplY3RUeXBlIiwicXVlcnlSZXN1bHRUeXBlIiwiZ3JhcGhRTFF1ZXJ5UmVzdWx0VHlwZSIsIm11dGF0aW9uUmVzdWx0VHlwZSIsImdyYXBoUUxNdXRhdGlvblJlc3VsdFR5cGUiLCJnZXQiLCJyb290Iiwid2hlcmUiLCJmaXJzdCIsIkdyYXBoUUxJbnQiLCJsYXN0IiwiYWZ0ZXIiLCJHcmFwaFFMU3RyaW5nIiwiYmVmb3JlIiwiY3JlYXRlIiwicmVzIiwicmVzdCIsImNvbmZpZyIsImF1dGgiLCJyZXNwb25zZSIsInVwZGF0ZSIsImlkIiwiZGVzdHJveSIsImRlbCIsImRpc3BsYXlOYW1lIiwiY2xhc3MiLCJyZXNlcnZlZEZpZWxkTmFtZXMiLCJjb25zdHJ1Y3RvciIsInNsaWNlIiwiYnVpbGRGaWVsZHMiLCJtYXBwZXIiLCJmaWx0ZXJSZXNlcnZlZCIsImlzT2JqZWN0IiwiaW5pdGlhbCIsInJlZHVjZSIsIm1lbW8iLCJnUUxGaWVsZCIsImdyYXBoUUxDb25maWciLCJpbnRlcmZhY2VzIiwiTm9kZSIsIlBhcnNlT2JqZWN0SW50ZXJmYWNlIiwiaXNUeXBlT2YiLCJhIiwiZ3JhcGhRTElucHV0Q29uZmlnIiwiZ3JhcGhRTFF1ZXJ5Q29uZmlnIiwiZ3JhcGhRTFVwZGF0ZUlucHV0Q29uZmlnIiwiZ3JhcGhRTFF1ZXJ5UmVzdWx0Q29uZmlnIiwibm9kZXMiLCJHcmFwaFFMTGlzdCIsImVkZ2VzIiwiR3JhcGhRTE9iamVjdFR5cGUiLCJub2RlIiwiY3Vyc29yIiwicGFnZUluZm8iLCJQYWdlSW5mbyIsImdyYXBoUUxNdXRhdGlvblJlc3VsdENvbmZpZyIsImNsaWVudE11dGF0aW9uSWQiLCJ1cGRhdGVJbnB1dE9iamVjdFR5cGUiLCJHcmFwaFFMSW5wdXRPYmplY3RUeXBlIiwiaW5wdXRPYmplY3RUeXBlIiwicXVlcnlJbnB1dE9iamVjdFR5cGUiLCJxdWVyeVJlc3VsdE9iamVjdFR5cGUiLCJtdXRhdGlvblJlc3VsdE9iamVjdFR5cGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBRUE7O0FBVUE7O0FBUUE7O0FBSUE7O0FBSUE7O0FBT0EsU0FBU0EsYUFBVCxDQUF1QkMsU0FBdkIsRUFBa0M7QUFDaEMsTUFBSUEsU0FBUyxLQUFLLFVBQWQsSUFBNEJBLFNBQVMsSUFBSSxJQUE3QyxFQUFtRDtBQUNqRCxXQUFPLElBQUlD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NEQsb0JBQVYsRUFBZ0M7QUFDOUIsV0FBS0Esb0JBQUwsR0FBNEIsSUFBSUYsK0JBQUosQ0FBMkIsS0FBS2Qsa0JBQUwsRUFBM0IsQ0FBNUI7QUFDRDs7QUFDRCxXQUFPLEtBQUtnQixvQkFBWjtBQUNEOztBQUVEMUQsRUFBQUEsc0JBQXNCLEdBQUc7QUFDdkIsUUFBSSxDQUFDLEtBQUsyRCxxQkFBVixFQUFpQztBQUMvQixXQUFLQSxxQkFBTCxHQUE2QixJQUFJWCwwQkFBSixDQUFzQixLQUFLSix3QkFBTCxFQUF0QixDQUE3QjtBQUNEOztBQUNELFdBQU8sS0FBS2UscUJBQVo7QUFDRDs7QUFFRHpELEVBQUFBLHlCQUF5QixHQUFHO0FBQzFCLFFBQUksQ0FBQyxLQUFLMEQsd0JBQVYsRUFBb0M7QUFDbEMsV0FBS0Esd0JBQUwsR0FBZ0MsSUFBSVosMEJBQUosQ0FBc0IsS0FBS0ssMkJBQUwsRUFBdEIsQ0FBaEM7QUFDRDs7QUFDRCxXQUFPLEtBQUtPLHdCQUFaO0FBQ0Q7O0FBektxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHJ1bkZpbmQsIHJ1bkdldCwgcmVzdCwgdHJhbnNmb3JtUmVzdWx0LCBjb25uZWN0aW9uUmVzdWx0c0FycmF5LCBwYXJzZUlEIH0gZnJvbSAnLi9leGVjdXRlJztcblxuaW1wb3J0IHtcbiAgR3JhcGhRTE9iamVjdFR5cGUsXG4gIEdyYXBoUUxJbnB1dE9iamVjdFR5cGUsXG4gIEdyYXBoUUxMaXN0LFxuICBHcmFwaFFMSW50LFxuICBHcmFwaFFMU3RyaW5nLFxuICBHcmFwaFFMSUQsXG4gIEdyYXBoUUxOb25OdWxsLFxufSBmcm9tICdncmFwaHFsJ1xuXG5pbXBvcnQge1xuICBxdWVyeVR5cGUsXG4gIGlucHV0VHlwZSxcbiAgdHlwZSxcbiAgUG9pbnRlcixcbiAgUGFnZUluZm8sXG59IGZyb20gJy4vdHlwZXMnXG5cbmltcG9ydCB7XG4gIE5vZGVcbn0gZnJvbSAnLi90eXBlcy9Ob2RlJztcblxuaW1wb3J0IHtcbiAgUGFyc2VPYmplY3RJbnRlcmZhY2Vcbn0gZnJvbSAnLi90eXBlcy9QYXJzZU9iamVjdCc7XG5cbmltcG9ydCB7XG4gIGdldE9yRWxzZSxcbiAgY2xlYXJDYWNoZSxcbn0gZnJvbSAnLi90eXBlc0NhY2hlJztcblxuZXhwb3J0IHsgY2xlYXJDYWNoZSB9O1xuXG5mdW5jdGlvbiBoYW5kbGVJZEZpZWxkKGZpZWxkTmFtZSkge1xuICBpZiAoZmllbGROYW1lID09PSAnb2JqZWN0SWQnIHx8IGZpZWxkTmFtZSA9PSAnaWQnKSB7XG4gICAgcmV0dXJuIG5ldyBHcmFwaFFMTm9uTnVsbChHcmFwaFFMSUQpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldFJlbGF0aW9uRmllbGQoZmllbGROYW1lLCBmaWVsZCwgc2NoZW1hKSB7XG4gIGlmIChmaWVsZC50eXBlID09ICdSZWxhdGlvbicpIHtcbiAgICBjb25zdCB7IGZpbmQgfSA9IGxvYWRDbGFzcyhmaWVsZC50YXJnZXRDbGFzcywgc2NoZW1hKTtcbiAgICBmaW5kLnJlc29sdmUgPSBhc3luYyAocGFyZW50LCBhcmdzLCBjb250ZXh0LCBpbmZvKSA9PiB7XG4gICAgICBjb25zdCBxdWVyeSA9IHtcbiAgICAgICAgJHJlbGF0ZWRUbzoge1xuICAgICAgICAgIG9iamVjdDoge1xuICAgICAgICAgICAgX190eXBlOiAnUG9pbnRlcicsXG4gICAgICAgICAgICBjbGFzc05hbWU6IHBhcmVudC5jbGFzc05hbWUsXG4gICAgICAgICAgICBvYmplY3RJZDogcGFyZW50Lm9iamVjdElkXG4gICAgICAgICAgfSxcbiAgICAgICAgICBrZXk6IGZpZWxkTmFtZSxcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYXJncy5yZWRpcmVjdENsYXNzTmFtZUZvcktleSA9IGZpZWxkTmFtZTtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBydW5GaW5kKGNvbnRleHQsIGluZm8sIHBhcmVudC5jbGFzc05hbWUsIGFyZ3MsIHNjaGVtYSwgcXVlcnkpO1xuICAgICAgcmV0dXJuIGNvbm5lY3Rpb25SZXN1bHRzQXJyYXkocmVzdWx0cywgYXJncywgMTAwKTtcbiAgICB9O1xuICAgIHJldHVybiBmaW5kO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdyYXBoUUxGaWVsZChmaWVsZE5hbWUsIGZpZWxkLCBzY2hlbWEpIHtcbiAgbGV0IGdRTFR5cGUgPSBoYW5kbGVJZEZpZWxkKGZpZWxkTmFtZSkgfHwgdHlwZShmaWVsZCk7XG4gIGlmICghZ1FMVHlwZSkge1xuICAgIC8vIElmIGl0J3Mgbm90IHBvc3NpYmxlIHRvIHJlc292bGUgYSBzaW1wbGUgdHlwZVxuICAgIC8vIGNoZWNrIGlmIGl0J3MgYSBwcm9wZXIgcmVsYXRpb24gZmllbGRcbiAgICByZXR1cm4gZ2V0UmVsYXRpb25GaWVsZChmaWVsZE5hbWUsIGZpZWxkLCBzY2hlbWEpO1xuICB9XG4gIGNvbnN0IGZpZWxkVHlwZSA9IChnUUxUeXBlID09PSBQb2ludGVyID8gYFBvaW50ZXI8JHtmaWVsZC50YXJnZXRDbGFzc30+YCA6IGAke2ZpZWxkLnR5cGV9YCk7XG4gIGxldCBnUUxSZXNvbHZlO1xuICBpZiAoZmllbGQudHlwZSA9PT0gJ1BvaW50ZXInKSB7XG4gICAgZ1FMVHlwZSA9IGxvYWRDbGFzcyhmaWVsZC50YXJnZXRDbGFzcywgc2NoZW1hKS5vYmplY3RUeXBlLFxuICAgIGdRTFJlc29sdmUgPSAocGFyZW50LCBhcmdzLCBjb250ZXh0LCBpbmZvKSA9PiB7XG4gICAgICBjb25zdCBvYmplY3QgPSBwYXJlbnRbZmllbGROYW1lXTtcbiAgICAgIGNvbnN0IHNlbGVjdGlvbnMgPSBpbmZvLmZpZWxkTm9kZXNbMF0uc2VsZWN0aW9uU2V0LnNlbGVjdGlvbnMubWFwKChmaWVsZCkgPT4ge1xuICAgICAgICByZXR1cm4gZmllbGQubmFtZS52YWx1ZTtcbiAgICAgIH0pO1xuICAgICAgaWYgKHNlbGVjdGlvbnMuaW5kZXhPZignaWQnKSA8IDAgfHwgc2VsZWN0aW9ucy5sZW5ndGggPiAxKSB7XG4gICAgICAgIHJldHVybiBydW5HZXQoY29udGV4dCwgaW5mbywgb2JqZWN0LmNsYXNzTmFtZSwgb2JqZWN0Lm9iamVjdElkLCBzY2hlbWEpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRyYW5zZm9ybVJlc3VsdChmaWVsZC50YXJnZXRDbGFzcywgb2JqZWN0LCBzY2hlbWEsIHsgY29udGV4dCwgaW5mbyB9KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBuYW1lOiBmaWVsZE5hbWUsXG4gICAgdHlwZTogZ1FMVHlwZSxcbiAgICByZXNvbHZlOiBnUUxSZXNvbHZlLFxuICAgIGRlc2NyaXB0aW9uOiBgQWNjZXNzb3IgZm9yICR7ZmllbGROYW1lfSAoJHtmaWVsZFR5cGV9KWAsXG4gIH07XG59XG5cbmZ1bmN0aW9uIGdyYXBoUUxJbnB1dEZpZWxkKGZpZWxkTmFtZSwgZmllbGQpIHtcbiAgY29uc3QgZ1FMVHlwZSA9IGhhbmRsZUlkRmllbGQoZmllbGROYW1lKSB8fCBpbnB1dFR5cGUoZmllbGQpO1xuICBpZiAoIWdRTFR5cGUpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgZmllbGRUeXBlID0gKGdRTFR5cGUgPT09IFBvaW50ZXIgPyBgUG9pbnRlcjwke2ZpZWxkLnRhcmdldENsYXNzfT5gIDogIGAke2ZpZWxkLnR5cGV9YCk7XG4gIHJldHVybiB7XG4gICAgbmFtZTogZmllbGROYW1lLFxuICAgIHR5cGU6IGdRTFR5cGUsXG4gICAgZGVzY3JpcHRpb246IGBTZXR0ZXIgZm9yICR7ZmllbGROYW1lfSAoJHtmaWVsZFR5cGV9KWAsXG4gIH07XG59XG5cbmZ1bmN0aW9uIGdyYXBoUUxRdWVyeUZpZWxkKGZpZWxkTmFtZSwgZmllbGQsIHNjaGVtYSkge1xuICBsZXQgZ1FMVHlwZSA9IGhhbmRsZUlkRmllbGQoZmllbGROYW1lKSB8fCBxdWVyeVR5cGUoZmllbGQpO1xuICBpZiAoIWdRTFR5cGUpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKGZpZWxkLnR5cGUgPT0gJ1BvaW50ZXInKSB7XG4gICAgZ1FMVHlwZSA9IGxvYWRDbGFzcyhmaWVsZC50YXJnZXRDbGFzcywgc2NoZW1hKS5xdWVyeVR5cGU7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBuYW1lOiBmaWVsZE5hbWUsXG4gICAgdHlwZTogZ1FMVHlwZSxcbiAgICBkZXNjcmlwdGlvbjogYFF1ZXJ5IGZvciAke2ZpZWxkTmFtZX0gKCR7ZmllbGQudHlwZX0pYCxcbiAgfTtcbn1cblxuZnVuY3Rpb24gdHJhbnNmb3JtSW5wdXQoaW5wdXQsIHNjaGVtYSkge1xuICBjb25zdCB7IGZpZWxkcyB9ID0gc2NoZW1hO1xuICBPYmplY3Qua2V5cyhpbnB1dCkuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSBpbnB1dFtrZXldO1xuICAgIGlmIChmaWVsZHNba2V5XSAmJiBmaWVsZHNba2V5XS50eXBlID09PSAnUG9pbnRlcicpIHtcbiAgICAgIHZhbHVlLl9fdHlwZSA9ICdQb2ludGVyJztcbiAgICB9IGVsc2UgaWYgKGZpZWxkc1trZXldICYmIGZpZWxkc1trZXldLnR5cGUgPT09ICdHZW9Qb2ludCcpIHtcbiAgICAgIHZhbHVlLl9fdHlwZSA9ICdHZW9Qb2ludCc7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGlucHV0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbG9hZENsYXNzKGNsYXNzTmFtZSwgc2NoZW1hKSB7XG4gIGNvbnN0IGMgPSBnZXRPckVsc2UoY2xhc3NOYW1lLCAoKSA9PiBuZXcgUGFyc2VDbGFzcyhjbGFzc05hbWUsIHNjaGVtYSkpO1xuICBjb25zdCBvYmplY3RUeXBlID0gYy5ncmFwaFFMT2JqZWN0VHlwZSgpO1xuICBjb25zdCBpbnB1dFR5cGUgPSBjLmdyYXBoUUxJbnB1dE9iamVjdFR5cGUoKTtcbiAgY29uc3QgdXBkYXRlVHlwZSA9IGMuZ3JhcGhRTFVwZGF0ZUlucHV0T2JqZWN0VHlwZSgpO1xuICBjb25zdCBxdWVyeVR5cGUgPSBjLmdyYXBoUUxRdWVyeUlucHV0T2JqZWN0VHlwZSgpO1xuICBjb25zdCBxdWVyeVJlc3VsdFR5cGUgPSBjLmdyYXBoUUxRdWVyeVJlc3VsdFR5cGUob2JqZWN0VHlwZSk7XG4gIGNvbnN0IG11dGF0aW9uUmVzdWx0VHlwZSA9IGMuZ3JhcGhRTE11dGF0aW9uUmVzdWx0VHlwZShvYmplY3RUeXBlKTtcblxuICBjb25zdCBnZXQgPSB7XG4gICAgdHlwZTogb2JqZWN0VHlwZSxcbiAgICBkZXNjcmlwdGlvbjogYFVzZSB0aGlzIGVuZHBvaW50IHRvIGdldCBvciBxdWVyeSAke2NsYXNzTmFtZX0gb2JqZWN0c2AsXG4gICAgYXJnczoge1xuICAgICAgb2JqZWN0SWQ6IHsgdHlwZTogR3JhcGhRTElEIH0sXG4gICAgfSxcbiAgICByZXNvbHZlOiBhc3luYyAocm9vdCwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xuICAgICAgLy8gR2V0IHRoZSBzZWxlY3Rpb25zXG4gICAgICByZXR1cm4gYXdhaXQgcnVuR2V0KGNvbnRleHQsIGluZm8sIGNsYXNzTmFtZSwgYXJncy5vYmplY3RJZCwgc2NoZW1hKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZmluZCA9IHtcbiAgICB0eXBlOiBxdWVyeVJlc3VsdFR5cGUsXG4gICAgZGVzY3JpcHRpb246IGBVc2UgdGhpcyBlbmRwb2ludCB0byBnZXQgb3IgcXVlcnkgJHtjbGFzc05hbWV9IG9iamVjdHNgLFxuICAgIGFyZ3M6IHtcbiAgICAgIHdoZXJlOiB7IHR5cGU6IHF1ZXJ5VHlwZSB9LFxuICAgICAgZmlyc3Q6IHsgdHlwZTogR3JhcGhRTEludCB9LFxuICAgICAgbGFzdDogeyB0eXBlOiBHcmFwaFFMSW50IH0sXG4gICAgICBhZnRlcjogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgICBiZWZvcmU6IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9XG4gICAgfSxcbiAgICByZXNvbHZlOiBhc3luYyAocm9vdCwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xuICAgICAgLy8gR2V0IHRoZSBzZWxlY3Rpb25zXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgcnVuRmluZChjb250ZXh0LCBpbmZvLCBjbGFzc05hbWUsIGFyZ3MsIHNjaGVtYSk7XG4gICAgICByZXR1cm4gY29ubmVjdGlvblJlc3VsdHNBcnJheShyZXN1bHRzLCBhcmdzLCAxMDApO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBjcmVhdGUgPSB7XG4gICAgdHlwZTogbXV0YXRpb25SZXN1bHRUeXBlLFxuICAgIGZpZWxkczogb2JqZWN0VHlwZS5maWVsZHMsXG4gICAgZGVzY3JpcHRpb246IGB1c2UgdGhpcyBtZXRob2QgdG8gY3JlYXRlIGEgbmV3ICR7Y2xhc3NOYW1lfWAsXG4gICAgYXJnczogeyBpbnB1dDogeyB0eXBlOiBpbnB1dFR5cGUgfX0sXG4gICAgcmVzb2x2ZTogYXN5bmMgKHJvb3QsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcbiAgICAgIGNvbnN0IGlucHV0ID0gdHJhbnNmb3JtSW5wdXQoYXJncy5pbnB1dCwgc2NoZW1hW2NsYXNzTmFtZV0pO1xuICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVzdC5jcmVhdGUoY29udGV4dC5jb25maWcsIGNvbnRleHQuYXV0aCwgY2xhc3NOYW1lLCBpbnB1dCk7XG4gICAgICAvLyBSdW4gZ2V0IHRvIG1hdGNoIGdyYXBoUUwgc3R5bGVcbiAgICAgIGNvbnN0IG9iamVjdCA9IGF3YWl0IHJ1bkdldChjb250ZXh0LCBpbmZvLCBjbGFzc05hbWUsIHJlcy5yZXNwb25zZS5vYmplY3RJZCk7XG4gICAgICByZXR1cm4geyBvYmplY3QgfTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgdXBkYXRlID0ge1xuICAgIHR5cGU6IG11dGF0aW9uUmVzdWx0VHlwZSxcbiAgICBkZXNjcmlwdGlvbjogYHVzZSB0aGlzIG1ldGhvZCB0byB1cGRhdGUgYW4gZXhpc3RpbmcgJHtjbGFzc05hbWV9YCxcbiAgICBhcmdzOiB7XG4gICAgICBpbnB1dDogeyB0eXBlOiB1cGRhdGVUeXBlIH1cbiAgICB9LFxuICAgIHJlc29sdmU6IGFzeW5jIChyb290LCBhcmdzLCBjb250ZXh0LCBpbmZvKSA9PiB7XG4gICAgICBpZiAoIWFyZ3MuaW5wdXQuaWQgJiYgIWFyZ3MuaW5wdXQub2JqZWN0SWQpIHtcbiAgICAgICAgdGhyb3cgJ2lkIG9yIG9iamVjdElkIGFyZSByZXF1aXJlZCc7XG4gICAgICB9XG4gICAgICBsZXQgb2JqZWN0SWQ7XG4gICAgICBpZiAoYXJncy5pbnB1dC5vYmplY3RJZCkge1xuICAgICAgICBvYmplY3RJZCA9IGFyZ3MuaW5wdXQub2JqZWN0SWQ7XG4gICAgICAgIGRlbGV0ZSBhcmdzLmlucHV0Lm9iamVjdElkO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb2JqZWN0SWQgPSBwYXJzZUlEKGFyZ3MuaW5wdXQuaWQpLm9iamVjdElkO1xuICAgICAgICBkZWxldGUgYXJncy5pbnB1dC5pZDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGlucHV0ID0gdHJhbnNmb3JtSW5wdXQoYXJncy5pbnB1dCwgc2NoZW1hW2NsYXNzTmFtZV0pO1xuICAgICAgYXdhaXQgcmVzdC51cGRhdGUoY29udGV4dC5jb25maWcsIGNvbnRleHQuYXV0aCwgY2xhc3NOYW1lLCB7IG9iamVjdElkIH0sIGlucHV0KTtcbiAgICAgIC8vIFJ1biBnZXQgdG8gbWF0Y2ggZ3JhcGhRTCBzdHlsZVxuICAgICAgY29uc3Qgb2JqZWN0ID0gYXdhaXQgcnVuR2V0KGNvbnRleHQsIGluZm8sIGNsYXNzTmFtZSwgb2JqZWN0SWQpO1xuICAgICAgcmV0dXJuIHsgb2JqZWN0IH07XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGRlc3Ryb3kgPSB7XG4gICAgdHlwZTogbXV0YXRpb25SZXN1bHRUeXBlLFxuICAgIGRlc2NyaXB0aW9uOiBgdXNlIHRoaXMgbWV0aG9kIHRvIHVwZGF0ZSBkZWxldGUgYW4gZXhpc3RpbmcgJHtjbGFzc05hbWV9YCxcbiAgICBhcmdzOiB7XG4gICAgICBvYmplY3RJZDogeyB0eXBlOiBuZXcgR3JhcGhRTE5vbk51bGwoR3JhcGhRTElEKSB9XG4gICAgfSxcbiAgICByZXNvbHZlOiBhc3luYyAocm9vdCwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xuICAgICAgY29uc3Qgb2JqZWN0ID0gYXdhaXQgcnVuR2V0KGNvbnRleHQsIGluZm8sIGNsYXNzTmFtZSwgYXJncy5vYmplY3RJZCk7XG4gICAgICBhd2FpdCByZXN0LmRlbChjb250ZXh0LmNvbmZpZywgY29udGV4dC5hdXRoLCBjbGFzc05hbWUsIGFyZ3Mub2JqZWN0SWQpO1xuICAgICAgcmV0dXJuIHsgb2JqZWN0IH1cbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIHsgZGlzcGxheU5hbWU6IGMuZGlzcGxheU5hbWUsIGdldCwgZmluZCwgY3JlYXRlLCB1cGRhdGUsIGRlc3Ryb3ksIG9iamVjdFR5cGUsIGlucHV0VHlwZSwgdXBkYXRlVHlwZSwgcXVlcnlUeXBlLCBxdWVyeVJlc3VsdFR5cGUsIG11dGF0aW9uUmVzdWx0VHlwZSwgY2xhc3M6IGMgfVxufVxuXG5jb25zdCByZXNlcnZlZEZpZWxkTmFtZXMgPSBbJ29iamVjdElkJywgJ2NyZWF0ZWRBdCcsICd1cGRhdGVkQXQnXTtcblxuZXhwb3J0IGNsYXNzIFBhcnNlQ2xhc3Mge1xuICBzY2hlbWE7XG4gIGNsYXNzTmFtZTtcbiAgY2xhc3M7XG5cbiAgY29uc3RydWN0b3IoY2xhc3NOYW1lLCBzY2hlbWEpIHtcbiAgICB0aGlzLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcbiAgICB0aGlzLmRpc3BsYXlOYW1lID0gY2xhc3NOYW1lO1xuICAgIGlmICh0aGlzLmNsYXNzTmFtZS5pbmRleE9mKCdfJykgPT09IDApIHtcbiAgICAgIHRoaXMuZGlzcGxheU5hbWUgPSB0aGlzLmNsYXNzTmFtZS5zbGljZSgxKTtcbiAgICB9XG4gICAgdGhpcy5zY2hlbWEgPSBzY2hlbWE7XG4gICAgdGhpcy5jbGFzcyA9IHRoaXMuc2NoZW1hW2NsYXNzTmFtZV07XG4gIH1cblxuICBidWlsZEZpZWxkcyhtYXBwZXIsIGZpbHRlclJlc2VydmVkID0gZmFsc2UsIGlzT2JqZWN0ID0gZmFsc2UpIHtcbiAgICBjb25zdCBmaWVsZHMgPSB0aGlzLmNsYXNzLmZpZWxkcztcbiAgICBjb25zdCBpbml0aWFsID0ge307XG4gICAgaWYgKGlzT2JqZWN0KSB7XG4gICAgICBpbml0aWFsLmlkID0ge1xuICAgICAgICBkZXNjcmlwdGlvbjogJ0EgZ2xvYmFseSB1bmlxdWUgaWRlbnRpZmllci4nLFxuICAgICAgICB0eXBlOiBuZXcgR3JhcGhRTE5vbk51bGwoR3JhcGhRTElEKVxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKGZpZWxkcykucmVkdWNlKChtZW1vLCBmaWVsZE5hbWUpID0+IHtcbiAgICAgIGlmIChmaWx0ZXJSZXNlcnZlZCAmJiByZXNlcnZlZEZpZWxkTmFtZXMuaW5kZXhPZihmaWVsZE5hbWUpID49IDApIHtcbiAgICAgICAgcmV0dXJuIG1lbW87XG4gICAgICB9XG4gICAgICBjb25zdCBmaWVsZCA9IGZpZWxkc1tmaWVsZE5hbWVdO1xuICAgICAgY29uc3QgZ1FMRmllbGQgPSBtYXBwZXIoZmllbGROYW1lLCBmaWVsZCwgdGhpcy5zY2hlbWEpO1xuICAgICAgaWYgKCFnUUxGaWVsZCkge1xuICAgICAgICByZXR1cm4gbWVtbztcbiAgICAgIH1cbiAgICAgIG1lbW9bZmllbGROYW1lXSA9IGdRTEZpZWxkO1xuICAgICAgcmV0dXJuIG1lbW87XG4gICAgfSwgaW5pdGlhbCk7XG4gIH1cblxuICBncmFwaFFMQ29uZmlnKCkge1xuICAgIGNvbnN0IGNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lO1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiB0aGlzLmRpc3BsYXlOYW1lLFxuICAgICAgZGVzY3JpcHRpb246IGBQYXJzZSBDbGFzcyAke2NsYXNzTmFtZX1gLFxuICAgICAgaW50ZXJmYWNlczogW05vZGUsIFBhcnNlT2JqZWN0SW50ZXJmYWNlXSxcbiAgICAgIGZpZWxkczogKCkgPT4gdGhpcy5idWlsZEZpZWxkcyhncmFwaFFMRmllbGQsIGZhbHNlLCB0cnVlKSxcbiAgICAgIGlzVHlwZU9mOiAoYSkgPT4ge1xuICAgICAgICByZXR1cm4gYS5jbGFzc05hbWUgPT0gY2xhc3NOYW1lO1xuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgZ3JhcGhRTElucHV0Q29uZmlnKCkge1xuICAgIGNvbnN0IGNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lO1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBgQ3JlYXRlJHt0aGlzLmRpc3BsYXlOYW1lfUlucHV0YCxcbiAgICAgIGRlc2NyaXB0aW9uOiBgUGFyc2UgQ2xhc3MgJHtjbGFzc05hbWV9IElucHV0YCxcbiAgICAgIGZpZWxkczogKCkgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5idWlsZEZpZWxkcyhncmFwaFFMSW5wdXRGaWVsZCwgdHJ1ZSk7XG4gICAgICB9LFxuICAgICAgaXNUeXBlT2Y6IGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgICAgIHJldHVybiBpbnB1dC5jbGFzc05hbWUgPT0gY2xhc3NOYW1lO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBncmFwaFFMUXVlcnlDb25maWcoKSB7XG4gICAgY29uc3QgY2xhc3NOYW1lID0gdGhpcy5jbGFzc05hbWU7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHRoaXMuZGlzcGxheU5hbWUgKyAnUXVlcnknLFxuICAgICAgZGVzY3JpcHRpb246IGBQYXJzZSBDbGFzcyAke2NsYXNzTmFtZX0gUXVlcnlgLFxuICAgICAgZmllbGRzOiAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGZpZWxkcyA9IHRoaXMuYnVpbGRGaWVsZHMoZ3JhcGhRTFF1ZXJ5RmllbGQpO1xuICAgICAgICBkZWxldGUgZmllbGRzLm9iamVjdElkO1xuICAgICAgICBkZWxldGUgZmllbGRzLmlkO1xuICAgICAgICByZXR1cm4gZmllbGRzO1xuICAgICAgfSxcbiAgICAgIGlzVHlwZU9mOiBmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICByZXR1cm4gaW5wdXQuY2xhc3NOYW1lID09IGNsYXNzTmFtZTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgZ3JhcGhRTFVwZGF0ZUlucHV0Q29uZmlnKCkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBgVXBkYXRlJHt0aGlzLmRpc3BsYXlOYW1lfUlucHV0YCxcbiAgICAgIGRlc2NyaXB0aW9uOiBgUGFyc2UgQ2xhc3MgJHt0aGlzLmNsYXNzTmFtZX0gVXBkYXRlYCxcbiAgICAgIGZpZWxkczogKCkgPT4ge1xuICAgICAgICBjb25zdCBmaWVsZHMgPSB0aGlzLmJ1aWxkRmllbGRzKGdyYXBoUUxJbnB1dEZpZWxkLCB0cnVlKTtcbiAgICAgICAgZmllbGRzLmlkID0geyB0eXBlOiBHcmFwaFFMSUQgfTtcbiAgICAgICAgZmllbGRzLm9iamVjdElkID0geyB0eXBlOiBHcmFwaFFMSUQgfTtcbiAgICAgICAgcmV0dXJuIGZpZWxkcztcbiAgICAgIH0sXG4gICAgICBpc1R5cGVPZjogZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgICAgcmV0dXJuIGlucHV0LmNsYXNzTmFtZSA9PSB0aGlzLmNsYXNzTmFtZTtcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgZ3JhcGhRTFF1ZXJ5UmVzdWx0Q29uZmlnKCkge1xuICAgIGNvbnN0IG9iamVjdFR5cGUgPSB0aGlzLmdyYXBoUUxPYmplY3RUeXBlKCk7XG4gICAgcmV0dXJuICB7XG4gICAgICBuYW1lOiBgJHt0aGlzLmRpc3BsYXlOYW1lfVF1ZXJ5Q29ubmVjdGlvbmAsXG4gICAgICBmaWVsZHM6IHtcbiAgICAgICAgbm9kZXM6IHsgdHlwZTogbmV3IEdyYXBoUUxMaXN0KG9iamVjdFR5cGUpIH0sXG4gICAgICAgIGVkZ2VzOiB7XG4gICAgICAgICAgdHlwZTogbmV3IEdyYXBoUUxMaXN0KG5ldyBHcmFwaFFMT2JqZWN0VHlwZSh7XG4gICAgICAgICAgICBuYW1lOiBgJHt0aGlzLmNsYXNzTmFtZX1FZGdlYCxcbiAgICAgICAgICAgIGZpZWxkczogKCkgPT4gKHtcbiAgICAgICAgICAgICAgbm9kZTogeyB0eXBlOiBvYmplY3RUeXBlIH0sXG4gICAgICAgICAgICAgIGN1cnNvcjogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSkpXG4gICAgICAgIH0sXG4gICAgICAgIHBhZ2VJbmZvOiB7IHR5cGU6IFBhZ2VJbmZvIH0sXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZ3JhcGhRTE11dGF0aW9uUmVzdWx0Q29uZmlnKCkge1xuICAgIGNvbnN0IG9iamVjdFR5cGUgPSB0aGlzLmdyYXBoUUxPYmplY3RUeXBlKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IGAke3RoaXMuZGlzcGxheU5hbWV9TXV0YXRpb25Db21wbGV0ZVBheWxvYWRgLFxuICAgICAgZmllbGRzOiB7XG4gICAgICAgIG9iamVjdDogeyB0eXBlOiBvYmplY3RUeXBlIH0sXG4gICAgICAgIGNsaWVudE11dGF0aW9uSWQ6IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZ3JhcGhRTE9iamVjdFR5cGUoKSB7XG4gICAgaWYgKCF0aGlzLm9iamVjdFR5cGUpIHtcbiAgICAgIHRoaXMub2JqZWN0VHlwZSA9IG5ldyBHcmFwaFFMT2JqZWN0VHlwZSh0aGlzLmdyYXBoUUxDb25maWcoKSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLm9iamVjdFR5cGU7XG4gIH1cblxuICBncmFwaFFMVXBkYXRlSW5wdXRPYmplY3RUeXBlKCkge1xuICAgIGlmICghdGhpcy51cGRhdGVJbnB1dE9iamVjdFR5cGUpIHtcbiAgICAgIHRoaXMudXBkYXRlSW5wdXRPYmplY3RUeXBlID0gbmV3IEdyYXBoUUxJbnB1dE9iamVjdFR5cGUodGhpcy5ncmFwaFFMVXBkYXRlSW5wdXRDb25maWcoKSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnVwZGF0ZUlucHV0T2JqZWN0VHlwZTtcbiAgfVxuXG4gIGdyYXBoUUxJbnB1dE9iamVjdFR5cGUoKSB7XG4gICAgaWYgKCF0aGlzLmlucHV0T2JqZWN0VHlwZSkge1xuICAgICAgdGhpcy5pbnB1dE9iamVjdFR5cGUgPSBuZXcgR3JhcGhRTElucHV0T2JqZWN0VHlwZSh0aGlzLmdyYXBoUUxJbnB1dENvbmZpZygpKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuaW5wdXRPYmplY3RUeXBlO1xuICB9XG5cbiAgZ3JhcGhRTFF1ZXJ5SW5wdXRPYmplY3RUeXBlKCkge1xuICAgIGlmICghdGhpcy5xdWVyeUlucHV0T2JqZWN0VHlwZSkge1xuICAgICAgdGhpcy5xdWVyeUlucHV0T2JqZWN0VHlwZSA9IG5ldyBHcmFwaFFMSW5wdXRPYmplY3RUeXBlKHRoaXMuZ3JhcGhRTFF1ZXJ5Q29uZmlnKCkpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5xdWVyeUlucHV0T2JqZWN0VHlwZTtcbiAgfVxuXG4gIGdyYXBoUUxRdWVyeVJlc3VsdFR5cGUoKSB7XG4gICAgaWYgKCF0aGlzLnF1ZXJ5UmVzdWx0T2JqZWN0VHlwZSkge1xuICAgICAgdGhpcy5xdWVyeVJlc3VsdE9iamVjdFR5cGUgPSBuZXcgR3JhcGhRTE9iamVjdFR5cGUodGhpcy5ncmFwaFFMUXVlcnlSZXN1bHRDb25maWcoKSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnF1ZXJ5UmVzdWx0T2JqZWN0VHlwZTtcbiAgfVxuXG4gIGdyYXBoUUxNdXRhdGlvblJlc3VsdFR5cGUoKSB7XG4gICAgaWYgKCF0aGlzLm11dGF0aW9uUmVzdWx0T2JqZWN0VHlwZSkge1xuICAgICAgdGhpcy5tdXRhdGlvblJlc3VsdE9iamVjdFR5cGUgPSBuZXcgR3JhcGhRTE9iamVjdFR5cGUodGhpcy5ncmFwaFFMTXV0YXRpb25SZXN1bHRDb25maWcoKSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLm11dGF0aW9uUmVzdWx0T2JqZWN0VHlwZTtcbiAgfVxufVxuXG4iXX0=