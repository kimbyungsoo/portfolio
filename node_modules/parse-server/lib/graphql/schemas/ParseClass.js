"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.loadClass = loadClass;
exports.getParseClassQueryFields = getParseClassQueryFields;
exports.getParseClassMutationFields = getParseClassMutationFields;
exports.default = exports.ParseClass = void 0;

var _execute = require("../execute");

var _Auth = require("../../Auth");

var _graphql = require("graphql");

var _types = require("../types");

var _Node = require("../types/Node");

var _typesCache = require("../typesCache");

var _ACL = require("../types/ACL");

function handleIdField(fieldName) {
  if (fieldName === 'objectId' || fieldName == 'id') {
    return new _graphql.GraphQLNonNull(_graphql.GraphQLID);
  }
}

function getRelationField(fieldName, field, schema) {
  const {
    find
  } = loadClass(field.targetClass, schema);

  find.resolve = async (parent, args, context, info) => {
    const query = {
      $relatedTo: {
        object: {
          __type: 'Pointer',
          className: parent.className,
          objectId: parent.objectId
        },
        key: fieldName
      }
    };
    args.redirectClassNameForKey = fieldName;
    const results = await (0, _execute.runFind)(context, info, parent.className, args, schema, query);
    results.forEach(result => {
      result.id = (0, _execute.getGloballyUniqueId)(result.className, result.objectId);
    });
    return (0, _execute.connectionResultsArray)(results, args, 100);
  };

  return find;
}

function getFieldType(field) {
  return field.type === 'Pointer' ? `Pointer<${field.targetClass}>` : `${field.type}`;
}

function graphQLField(fieldName, field, schema) {
  if (field.type == 'Relation') {
    return getRelationField(fieldName, field, schema);
  }

  let gQLType = handleIdField(fieldName) || (0, _types.type)(field);
  const fieldType = getFieldType(field);
  let gQLResolve;

  if (field.type === 'Pointer') {
    gQLType = loadClass(field.targetClass, schema).objectType;

    gQLResolve = (parent, args, context, info) => {
      return (0, _execute.resolvePointer)(field.targetClass, parent[fieldName], schema, context, info);
    };
  }

  return {
    name: fieldName,
    type: gQLType,
    resolve: gQLResolve,
    description: `Accessor for ${fieldName} (${fieldType})`
  };
}

function graphQLInputField(fieldName, field) {
  const gQLType = handleIdField(fieldName) || (0, _types.inputType)(field);

  if (!gQLType) {
    return;
  }

  const fieldType = getFieldType(field);
  return {
    name: fieldName,
    type: gQLType,
    description: `Setter for ${fieldName} (${fieldType})`
  };
}

function graphQLQueryField(fieldName, field, schema) {
  let gQLType = handleIdField(fieldName) || (0, _types.queryType)(field);

  if (!gQLType) {
    return;
  }

  if (field.type == 'Pointer') {
    gQLType = loadClass(field.targetClass, schema).queryType;
  }

  return {
    name: fieldName,
    type: gQLType,
    description: `Query for ${fieldName} (${field.type})`
  };
}

function transformInput(input, schema) {
  const {
    fields
  } = schema;
  Object.keys(input).forEach(key => {
    const value = input[key];

    if (fields[key] && fields[key].type === 'Pointer') {
      value.__type = 'Pointer';
    } else if (fields[key] && fields[key].type === 'GeoPoint') {
      value.__type = 'GeoPoint';
    } else if (key === 'ACL') {
      input[key] = (0, _ACL.toParseACL)(value);
    }
  });
  return input;
}

function getObjectId(input) {
  if (!input.id && !input.objectId) {
    throw 'id or objectId are required';
  }

  let objectId;

  if (input.objectId) {
    objectId = input.objectId;
    delete input.objectId;
  } else {
    objectId = (0, _execute.parseID)(input.id).objectId;
    delete input.id;
  }

  return objectId;
}

function loadClass(className, schema) {
  const c = (0, _typesCache.getOrElse)(className, () => new ParseClass(className, schema));
  const objectType = c.graphQLObjectType();
  const inputType = c.graphQLInputObjectType();
  const updateType = c.graphQLUpdateInputObjectType();
  const queryType = c.graphQLQueryInputObjectType();
  const queryResultType = c.graphQLQueryResultType(objectType);
  const mutationResultType = c.graphQLMutationResultType(objectType);
  const get = {
    type: objectType,
    description: `Use this endpoint to get or query ${className} objects`,
    args: {
      objectId: {
        type: new _graphql.GraphQLNonNull(_graphql.GraphQLID)
      }
    },
    resolve: async (root, args, context, info) => {
      // Get the selections
      return await (0, _execute.runGet)(context, info, className, args.objectId, schema);
    }
  };
  const find = {
    type: queryResultType,
    description: `Use this endpoint to get or query ${className} objects`,
    args: {
      where: {
        type: queryType
      },
      first: {
        type: _graphql.GraphQLInt
      },
      last: {
        type: _graphql.GraphQLInt
      },
      after: {
        type: _graphql.GraphQLString
      },
      before: {
        type: _graphql.GraphQLString
      }
    },
    resolve: async (root, args, context, info) => {
      // Get the selections
      const results = await (0, _execute.runFind)(context, info, className, args, schema);
      return (0, _execute.connectionResultsArray)(results, args, 100);
    }
  };
  const create = {
    type: mutationResultType,
    fields: objectType.fields,
    description: `use this method to create a new ${className}`,
    args: {
      input: {
        type: inputType
      }
    },
    resolve: async (root, args, context, info) => {
      let {
        auth
      } = context;
      const {
        config
      } = context;
      const input = transformInput(args.input, schema[className]);
      const clientMutationId = input.clientMutationId;
      delete input.clientMutationId;
      await (0, _execute.handleFileUpload)(config, auth, className, input, schema);
      const res = await _execute.rest.create(config, auth, className, input);

      if (className === '_User' && res.response && res.response.sessionToken) {
        auth = await (0, _Auth.getAuthForSessionToken)({
          config,
          installationId: context.info && context.info.installationId,
          sessionToken: res.response.sessionToken
        });
      } // Run get to match graphQL style


      const object = await (0, _execute.runGet)({
        auth,
        config
      }, info, className, res.response.objectId);
      return {
        object,
        clientMutationId
      };
    }
  };
  const update = {
    type: mutationResultType,
    description: `use this method to update an existing ${className}`,
    args: {
      input: {
        type: updateType
      }
    },
    resolve: async (root, args, context, info) => {
      const objectId = getObjectId(args.input);
      const input = transformInput(args.input, schema[className]);
      const clientMutationId = input.clientMutationId;
      delete input.clientMutationId;
      await (0, _execute.handleFileUpload)(context.config, context.auth, className, input, schema);
      await _execute.rest.update(context.config, context.auth, className, {
        objectId
      }, input); // Run get to match graphQL style

      const object = await (0, _execute.runGet)(context, info, className, objectId);
      return {
        object,
        clientMutationId
      };
    }
  };
  const destroy = {
    type: mutationResultType,
    description: `use this method to update delete an existing ${className}`,
    args: {
      input: {
        type: new _graphql.GraphQLInputObjectType({
          name: `Destroy${c.displayName}Input`,
          fields: {
            id: {
              type: _graphql.GraphQLID,
              description: 'Use either the global id or objectId'
            },
            objectId: {
              type: _graphql.GraphQLID,
              description: 'Use either the global id or objectId'
            },
            clientMutationId: {
              type: _graphql.GraphQLString
            }
          }
        })
      }
    },
    resolve: async (root, args, context, info) => {
      const objectId = getObjectId(args.input);
      const clientMutationId = args.input.clientMutationId;
      const object = await (0, _execute.runGet)(context, info, className, objectId);
      await _execute.rest.del(context.config, context.auth, className, objectId);
      return {
        object,
        clientMutationId
      };
    }
  };
  return {
    displayName: c.displayName,
    get,
    find,
    create,
    update,
    destroy,
    objectType,
    inputType,
    updateType,
    queryType,
    queryResultType,
    mutationResultType,
    parseClass: c
  };
}

const reservedFieldNames = ['objectId', 'createdAt', 'updatedAt'];

class ParseClass {
  constructor(className, schema) {
    this.className = className;
    this.displayName = className;

    if (this.className.indexOf('_') === 0) {
      this.displayName = this.className.slice(1);
    }

    this.schema = schema;
    this.class = this.schema[className];

    if (!this.class) {
      /* eslint-disable no-console */
      console.warn(`Attempting to load a class (${this.className}) that doesn't exist...`);
      console.trace();
      /* eslint-enable no-console */
    }
  }

  buildFields(mapper, filterReserved = false, isObject = false) {
    if (!this.class) {
      /* eslint-disable no-console */
      console.warn(`Attempting to build fields a class (${this.className}) that doesn't exist...`);
      console.trace();
      /* eslint-enable no-console */

      return;
    }

    const fields = this.class.fields;
    const initial = {};

    if (isObject) {
      initial.id = {
        description: 'A globaly unique identifier.',
        type: new _graphql.GraphQLNonNull(_graphql.GraphQLID)
      };
    }

    if (this.className === '_User') {
      initial.sessionToken = {
        description: 'The session token for the user, set only when it makes sense.',
        type: _graphql.GraphQLString
      };
    }

    return Object.keys(fields).reduce((memo, fieldName) => {
      if (filterReserved && reservedFieldNames.indexOf(fieldName) >= 0) {
        return memo;
      }

      const field = fields[fieldName];
      const gQLField = mapper(fieldName, field, this.schema);

      if (!gQLField) {
        return memo;
      }

      memo[fieldName] = gQLField;
      return memo;
    }, initial);
  }

  isTypeOf(object) {
    return object.className === this.className;
  }

  graphQLConfig() {
    const className = this.className;
    return {
      name: this.displayName,
      description: `Parse Class ${className}`,
      // in relay, it's impossible to have 2 interfaces???
      interfaces: [_Node.Node
      /* ParseObjectInterface */
      ],
      fields: () => this.buildFields(graphQLField, false, true),
      isTypeOf: this.isTypeOf.bind(this)
    };
  }

  graphQLQueryConfig() {
    const className = this.className;
    return {
      name: this.displayName + 'Query',
      description: `Parse Class ${className} Query`,
      fields: () => {
        const fields = this.buildFields(graphQLQueryField);
        delete fields.objectId;
        delete fields.id;
        return fields;
      },
      isTypeOf: this.isTypeOf.bind(this)
    };
  }

  graphQLInputConfig() {
    const className = this.className;
    return {
      name: `Add${this.displayName}Input`,
      description: `Parse Class ${className} Input`,
      fields: () => {
        const fields = this.buildFields(graphQLInputField, true);
        fields.clientMutationId = {
          type: _graphql.GraphQLString
        };
        return fields;
      },
      isTypeOf: this.isTypeOf.bind(this)
    };
  }

  graphQLUpdateInputConfig() {
    return {
      name: `Update${this.displayName}Input`,
      description: `Parse Class ${this.className} Update`,
      fields: () => {
        const fields = this.buildFields(graphQLInputField, true);
        fields.id = {
          type: _graphql.GraphQLID
        };
        fields.objectId = {
          type: _graphql.GraphQLID
        };
        fields.clientMutationId = {
          type: _graphql.GraphQLString
        };
        return fields;
      },
      isTypeOf: this.isTypeOf.bind(this)
    };
  }

  graphQLQueryResultConfig() {
    const objectType = this.graphQLObjectType();
    return {
      name: `${this.displayName}QueryConnection`,
      fields: {
        nodes: {
          type: new _graphql.GraphQLList(objectType)
        },
        edges: {
          type: new _graphql.GraphQLList(new _graphql.GraphQLObjectType({
            name: `${this.displayName}Edge`,
            fields: () => ({
              node: {
                type: objectType
              },
              cursor: {
                type: _graphql.GraphQLString
              }
            })
          }))
        },
        pageInfo: {
          type: _types.PageInfo
        }
      }
    };
  }

  graphQLMutationResultConfig() {
    const objectType = this.graphQLObjectType();
    return {
      name: `${this.displayName}MutationCompletePayload`,
      fields: {
        object: {
          type: objectType
        },
        clientMutationId: {
          type: _graphql.GraphQLString
        }
      }
    };
  }

  graphQLObjectType() {
    if (!this.objectType) {
      this.objectType = new _graphql.GraphQLObjectType(this.graphQLConfig());
    }

    return this.objectType;
  }

  graphQLUpdateInputObjectType() {
    if (!this.updateInputObjectType) {
      this.updateInputObjectType = new _graphql.GraphQLInputObjectType(this.graphQLUpdateInputConfig());
    }

    return this.updateInputObjectType;
  }

  graphQLInputObjectType() {
    if (!this.inputObjectType) {
      this.inputObjectType = new _graphql.GraphQLInputObjectType(this.graphQLInputConfig());
    }

    return this.inputObjectType;
  }

  graphQLQueryInputObjectType() {
    if (!this.queryInputObjectType) {
      this.queryInputObjectType = new _graphql.GraphQLInputObjectType(this.graphQLQueryConfig());
    }

    return this.queryInputObjectType;
  }

  graphQLQueryResultType() {
    if (!this.queryResultObjectType) {
      this.queryResultObjectType = new _graphql.GraphQLObjectType(this.graphQLQueryResultConfig());
    }

    return this.queryResultObjectType;
  }

  graphQLMutationResultType() {
    if (!this.mutationResultObjectType) {
      this.mutationResultObjectType = new _graphql.GraphQLObjectType(this.graphQLMutationResultConfig());
    }

    return this.mutationResultObjectType;
  }

}

exports.ParseClass = ParseClass;

function getParseClassQueryFields(schema) {
  return schema.__classNames.reduce((fields, className) => {
    const {
      get,
      find,
      displayName
    } = loadClass(className, schema);
    return Object.assign(fields, {
      [displayName]: get,
      [`find${displayName}`]: find
    });
  }, {});
}

function getParseClassMutationFields(schema) {
  return schema.__classNames.reduce((fields, className) => {
    const {
      create,
      update,
      destroy,
      displayName
    } = loadClass(className, schema);
    return Object.assign(fields, {
      [`add${displayName}`]: create,
      [`update${displayName}`]: update,
      [`destroy${displayName}`]: destroy
    });
  }, {});
}

var _default = {
  Query: getParseClassQueryFields,
  Mutation: getParseClassMutationFields
};
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9ncmFwaHFsL3NjaGVtYXMvUGFyc2VDbGFzcy5qcyJdLCJuYW1lcyI6WyJoYW5kbGVJZEZpZWxkIiwiZmllbGROYW1lIiwiR3JhcGhRTE5vbk51bGwiLCJHcmFwaFFMSUQiLCJnZXRSZWxhdGlvbkZpZWxkIiwiZmllbGQiLCJzY2hlbWEiLCJmaW5kIiwibG9hZENsYXNzIiwidGFyZ2V0Q2xhc3MiLCJyZXNvbHZlIiwicGFyZW50IiwiYXJncyIsImNvbnRleHQiLCJpbmZvIiwicXVlcnkiLCIkcmVsYXRlZFRvIiwib2JqZWN0IiwiX190eXBlIiwiY2xhc3NOYW1lIiwib2JqZWN0SWQiLCJrZXkiLCJyZWRpcmVjdENsYXNzTmFtZUZvcktleSIsInJlc3VsdHMiLCJmb3JFYWNoIiwicmVzdWx0IiwiaWQiLCJnZXRGaWVsZFR5cGUiLCJ0eXBlIiwiZ3JhcGhRTEZpZWxkIiwiZ1FMVHlwZSIsImZpZWxkVHlwZSIsImdRTFJlc29sdmUiLCJvYmplY3RUeXBlIiwibmFtZSIsImRlc2NyaXB0aW9uIiwiZ3JhcGhRTElucHV0RmllbGQiLCJncmFwaFFMUXVlcnlGaWVsZCIsInF1ZXJ5VHlwZSIsInRyYW5zZm9ybUlucHV0IiwiaW5wdXQiLCJmaWVsZHMiLCJPYmplY3QiLCJrZXlzIiwidmFsdWUiLCJnZXRPYmplY3RJZCIsImMiLCJQYXJzZUNsYXNzIiwiZ3JhcGhRTE9iamVjdFR5cGUiLCJpbnB1dFR5cGUiLCJncmFwaFFMSW5wdXRPYmplY3RUeXBlIiwidXBkYXRlVHlwZSIsImdyYXBoUUxVcGRhdGVJbnB1dE9iamVjdFR5cGUiLCJncmFwaFFMUXVlcnlJbnB1dE9iamVjdFR5cGUiLCJxdWVyeVJlc3VsdFR5cGUiLCJncmFwaFFMUXVlcnlSZXN1bHRUeXBlIiwibXV0YXRpb25SZXN1bHRUeXBlIiwiZ3JhcGhRTE11dGF0aW9uUmVzdWx0VHlwZSIsImdldCIsInJvb3QiLCJ3aGVyZSIsImZpcnN0IiwiR3JhcGhRTEludCIsImxhc3QiLCJhZnRlciIsIkdyYXBoUUxTdHJpbmciLCJiZWZvcmUiLCJjcmVhdGUiLCJhdXRoIiwiY29uZmlnIiwiY2xpZW50TXV0YXRpb25JZCIsInJlcyIsInJlc3QiLCJyZXNwb25zZSIsInNlc3Npb25Ub2tlbiIsImluc3RhbGxhdGlvbklkIiwidXBkYXRlIiwiZGVzdHJveSIsIkdyYXBoUUxJbnB1dE9iamVjdFR5cGUiLCJkaXNwbGF5TmFtZSIsImRlbCIsInBhcnNlQ2xhc3MiLCJyZXNlcnZlZEZpZWxkTmFtZXMiLCJjb25zdHJ1Y3RvciIsImluZGV4T2YiLCJzbGljZSIsImNsYXNzIiwiY29uc29sZSIsIndhcm4iLCJ0cmFjZSIsImJ1aWxkRmllbGRzIiwibWFwcGVyIiwiZmlsdGVyUmVzZXJ2ZWQiLCJpc09iamVjdCIsImluaXRpYWwiLCJyZWR1Y2UiLCJtZW1vIiwiZ1FMRmllbGQiLCJpc1R5cGVPZiIsImdyYXBoUUxDb25maWciLCJpbnRlcmZhY2VzIiwiTm9kZSIsImJpbmQiLCJncmFwaFFMUXVlcnlDb25maWciLCJncmFwaFFMSW5wdXRDb25maWciLCJncmFwaFFMVXBkYXRlSW5wdXRDb25maWciLCJncmFwaFFMUXVlcnlSZXN1bHRDb25maWciLCJub2RlcyIsIkdyYXBoUUxMaXN0IiwiZWRnZXMiLCJHcmFwaFFMT2JqZWN0VHlwZSIsIm5vZGUiLCJjdXJzb3IiLCJwYWdlSW5mbyIsIlBhZ2VJbmZvIiwiZ3JhcGhRTE11dGF0aW9uUmVzdWx0Q29uZmlnIiwidXBkYXRlSW5wdXRPYmplY3RUeXBlIiwiaW5wdXRPYmplY3RUeXBlIiwicXVlcnlJbnB1dE9iamVjdFR5cGUiLCJxdWVyeVJlc3VsdE9iamVjdFR5cGUiLCJtdXRhdGlvblJlc3VsdE9iamVjdFR5cGUiLCJnZXRQYXJzZUNsYXNzUXVlcnlGaWVsZHMiLCJfX2NsYXNzTmFtZXMiLCJhc3NpZ24iLCJnZXRQYXJzZUNsYXNzTXV0YXRpb25GaWVsZHMiLCJRdWVyeSIsIk11dGF0aW9uIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7O0FBVUE7O0FB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QjtBQUEyQkUsTUFBQUE7QUFBM0IsUUFBMkN2RSxTQUFTLENBQ3hEVyxTQUR3RCxFQUV4RGIsTUFGd0QsQ0FBMUQ7QUFJQSxXQUFPb0MsTUFBTSxDQUFDaUYsTUFBUCxDQUFjbEYsTUFBZCxFQUFzQjtBQUMzQixPQUFFLE1BQUtzQyxXQUFZLEVBQW5CLEdBQXVCWixNQURJO0FBRTNCLE9BQUUsU0FBUVksV0FBWSxFQUF0QixHQUEwQkgsTUFGQztBQUczQixPQUFFLFVBQVNHLFdBQVksRUFBdkIsR0FBMkJGO0FBSEEsS0FBdEIsQ0FBUDtBQUtELEdBVk0sRUFVSixFQVZJLENBQVA7QUFXRDs7ZUFFYztBQUNiZ0QsRUFBQUEsS0FBSyxFQUFFSix3QkFETTtBQUViSyxFQUFBQSxRQUFRLEVBQUVGO0FBRkcsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIHJ1bkZpbmQsXG4gIHJ1bkdldCxcbiAgcmVzb2x2ZVBvaW50ZXIsXG4gIHJlc3QsXG4gIGNvbm5lY3Rpb25SZXN1bHRzQXJyYXksXG4gIHBhcnNlSUQsXG4gIGdldEdsb2JhbGx5VW5pcXVlSWQsXG4gIGhhbmRsZUZpbGVVcGxvYWQsXG59IGZyb20gJy4uL2V4ZWN1dGUnO1xuaW1wb3J0IHsgZ2V0QXV0aEZvclNlc3Npb25Ub2tlbiB9IGZyb20gJy4uLy4uL0F1dGgnO1xuXG5pbXBvcnQge1xuICBHcmFwaFFMT2JqZWN0VHlwZSxcbiAgR3JhcGhRTElucHV0T2JqZWN0VHlwZSxcbiAgR3JhcGhRTExpc3QsXG4gIEdyYXBoUUxJbnQsXG4gIEdyYXBoUUxTdHJpbmcsXG4gIEdyYXBoUUxJRCxcbiAgR3JhcGhRTE5vbk51bGwsXG59IGZyb20gJ2dyYXBocWwnO1xuXG5pbXBvcnQgeyBxdWVyeVR5cGUsIGlucHV0VHlwZSwgdHlwZSwgUGFnZUluZm8gfSBmcm9tICcuLi90eXBlcyc7XG5cbmltcG9ydCB7IE5vZGUgfSBmcm9tICcuLi90eXBlcy9Ob2RlJztcblxuaW1wb3J0IHsgZ2V0T3JFbHNlIH0gZnJvbSAnLi4vdHlwZXNDYWNoZSc7XG5pbXBvcnQgeyB0b1BhcnNlQUNMIH0gZnJvbSAnLi4vdHlwZXMvQUNMJztcblxuZnVuY3Rpb24gaGFuZGxlSWRGaWVsZChmaWVsZE5hbWUpIHtcbiAgaWYgKGZpZWxkTmFtZSA9PT0gJ29iamVjdElkJyB8fCBmaWVsZE5hbWUgPT0gJ2lkJykge1xuICAgIHJldHVybiBuZXcgR3JhcGhRTE5vbk51bGwoR3JhcGhRTElEKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRSZWxhdGlvbkZpZWxkKGZpZWxkTmFtZSwgZmllbGQsIHNjaGVtYSkge1xuICBjb25zdCB7IGZpbmQgfSA9IGxvYWRDbGFzcyhmaWVsZC50YXJnZXRDbGFzcywgc2NoZW1hKTtcbiAgZmluZC5yZXNvbHZlID0gYXN5bmMgKHBhcmVudCwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xuICAgIGNvbnN0IHF1ZXJ5ID0ge1xuICAgICAgJHJlbGF0ZWRUbzoge1xuICAgICAgICBvYmplY3Q6IHtcbiAgICAgICAgICBfX3R5cGU6ICdQb2ludGVyJyxcbiAgICAgICAgICBjbGFzc05hbWU6IHBhcmVudC5jbGFzc05hbWUsXG4gICAgICAgICAgb2JqZWN0SWQ6IHBhcmVudC5vYmplY3RJZCxcbiAgICAgICAgfSxcbiAgICAgICAga2V5OiBmaWVsZE5hbWUsXG4gICAgICB9LFxuICAgIH07XG4gICAgYXJncy5yZWRpcmVjdENsYXNzTmFtZUZvcktleSA9IGZpZWxkTmFtZTtcbiAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgcnVuRmluZChcbiAgICAgIGNvbnRleHQsXG4gICAgICBpbmZvLFxuICAgICAgcGFyZW50LmNsYXNzTmFtZSxcbiAgICAgIGFyZ3MsXG4gICAgICBzY2hlbWEsXG4gICAgICBxdWVyeVxuICAgICk7XG4gICAgcmVzdWx0cy5mb3JFYWNoKHJlc3VsdCA9PiB7XG4gICAgICByZXN1bHQuaWQgPSBnZXRHbG9iYWxseVVuaXF1ZUlkKHJlc3VsdC5jbGFzc05hbWUsIHJlc3VsdC5vYmplY3RJZCk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGNvbm5lY3Rpb25SZXN1bHRzQXJyYXkocmVzdWx0cywgYXJncywgMTAwKTtcbiAgfTtcbiAgcmV0dXJuIGZpbmQ7XG59XG5cbmZ1bmN0aW9uIGdldEZpZWxkVHlwZShmaWVsZCkge1xuICByZXR1cm4gZmllbGQudHlwZSA9PT0gJ1BvaW50ZXInXG4gICAgPyBgUG9pbnRlcjwke2ZpZWxkLnRhcmdldENsYXNzfT5gXG4gICAgOiBgJHtmaWVsZC50eXBlfWA7XG59XG5cbmZ1bmN0aW9uIGdyYXBoUUxGaWVsZChmaWVsZE5hbWUsIGZpZWxkLCBzY2hlbWEpIHtcbiAgaWYgKGZpZWxkLnR5cGUgPT0gJ1JlbGF0aW9uJykge1xuICAgIHJldHVybiBnZXRSZWxhdGlvbkZpZWxkKGZpZWxkTmFtZSwgZmllbGQsIHNjaGVtYSk7XG4gIH1cblxuICBsZXQgZ1FMVHlwZSA9IGhhbmRsZUlkRmllbGQoZmllbGROYW1lKSB8fCB0eXBlKGZpZWxkKTtcbiAgY29uc3QgZmllbGRUeXBlID0gZ2V0RmllbGRUeXBlKGZpZWxkKTtcbiAgbGV0IGdRTFJlc29sdmU7XG4gIGlmIChmaWVsZC50eXBlID09PSAnUG9pbnRlcicpIHtcbiAgICBnUUxUeXBlID0gbG9hZENsYXNzKGZpZWxkLnRhcmdldENsYXNzLCBzY2hlbWEpLm9iamVjdFR5cGU7XG4gICAgZ1FMUmVzb2x2ZSA9IChwYXJlbnQsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcbiAgICAgIHJldHVybiByZXNvbHZlUG9pbnRlcihcbiAgICAgICAgZmllbGQudGFyZ2V0Q2xhc3MsXG4gICAgICAgIHBhcmVudFtmaWVsZE5hbWVdLFxuICAgICAgICBzY2hlbWEsXG4gICAgICAgIGNvbnRleHQsXG4gICAgICAgIGluZm9cbiAgICAgICk7XG4gICAgfTtcbiAgfVxuICByZXR1cm4ge1xuICAgIG5hbWU6IGZpZWxkTmFtZSxcbiAgICB0eXBlOiBnUUxUeXBlLFxuICAgIHJlc29sdmU6IGdRTFJlc29sdmUsXG4gICAgZGVzY3JpcHRpb246IGBBY2Nlc3NvciBmb3IgJHtmaWVsZE5hbWV9ICgke2ZpZWxkVHlwZX0pYCxcbiAgfTtcbn1cblxuZnVuY3Rpb24gZ3JhcGhRTElucHV0RmllbGQoZmllbGROYW1lLCBmaWVsZCkge1xuICBjb25zdCBnUUxUeXBlID0gaGFuZGxlSWRGaWVsZChmaWVsZE5hbWUpIHx8IGlucHV0VHlwZShmaWVsZCk7XG4gIGlmICghZ1FMVHlwZSkge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBmaWVsZFR5cGUgPSBnZXRGaWVsZFR5cGUoZmllbGQpO1xuICByZXR1cm4ge1xuICAgIG5hbWU6IGZpZWxkTmFtZSxcbiAgICB0eXBlOiBnUUxUeXBlLFxuICAgIGRlc2NyaXB0aW9uOiBgU2V0dGVyIGZvciAke2ZpZWxkTmFtZX0gKCR7ZmllbGRUeXBlfSlgLFxuICB9O1xufVxuXG5mdW5jdGlvbiBncmFwaFFMUXVlcnlGaWVsZChmaWVsZE5hbWUsIGZpZWxkLCBzY2hlbWEpIHtcbiAgbGV0IGdRTFR5cGUgPSBoYW5kbGVJZEZpZWxkKGZpZWxkTmFtZSkgfHwgcXVlcnlUeXBlKGZpZWxkKTtcbiAgaWYgKCFnUUxUeXBlKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmIChmaWVsZC50eXBlID09ICdQb2ludGVyJykge1xuICAgIGdRTFR5cGUgPSBsb2FkQ2xhc3MoZmllbGQudGFyZ2V0Q2xhc3MsIHNjaGVtYSkucXVlcnlUeXBlO1xuICB9XG4gIHJldHVybiB7XG4gICAgbmFtZTogZmllbGROYW1lLFxuICAgIHR5cGU6IGdRTFR5cGUsXG4gICAgZGVzY3JpcHRpb246IGBRdWVyeSBmb3IgJHtmaWVsZE5hbWV9ICgke2ZpZWxkLnR5cGV9KWAsXG4gIH07XG59XG5cbmZ1bmN0aW9uIHRyYW5zZm9ybUlucHV0KGlucHV0LCBzY2hlbWEpIHtcbiAgY29uc3QgeyBmaWVsZHMgfSA9IHNjaGVtYTtcbiAgT2JqZWN0LmtleXMoaW5wdXQpLmZvckVhY2goa2V5ID0+IHtcbiAgICBjb25zdCB2YWx1ZSA9IGlucHV0W2tleV07XG4gICAgaWYgKGZpZWxkc1trZXldICYmIGZpZWxkc1trZXldLnR5cGUgPT09ICdQb2ludGVyJykge1xuICAgICAgdmFsdWUuX190eXBlID0gJ1BvaW50ZXInO1xuICAgIH0gZWxzZSBpZiAoZmllbGRzW2tleV0gJiYgZmllbGRzW2tleV0udHlwZSA9PT0gJ0dlb1BvaW50Jykge1xuICAgICAgdmFsdWUuX190eXBlID0gJ0dlb1BvaW50JztcbiAgICB9IGVsc2UgaWYgKGtleSA9PT0gJ0FDTCcpIHtcbiAgICAgIGlucHV0W2tleV0gPSB0b1BhcnNlQUNMKHZhbHVlKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gaW5wdXQ7XG59XG5cbmZ1bmN0aW9uIGdldE9iamVjdElkKGlucHV0KSB7XG4gIGlmICghaW5wdXQuaWQgJiYgIWlucHV0Lm9iamVjdElkKSB7XG4gICAgdGhyb3cgJ2lkIG9yIG9iamVjdElkIGFyZSByZXF1aXJlZCc7XG4gIH1cbiAgbGV0IG9iamVjdElkO1xuICBpZiAoaW5wdXQub2JqZWN0SWQpIHtcbiAgICBvYmplY3RJZCA9IGlucHV0Lm9iamVjdElkO1xuICAgIGRlbGV0ZSBpbnB1dC5vYmplY3RJZDtcbiAgfSBlbHNlIHtcbiAgICBvYmplY3RJZCA9IHBhcnNlSUQoaW5wdXQuaWQpLm9iamVjdElkO1xuICAgIGRlbGV0ZSBpbnB1dC5pZDtcbiAgfVxuICByZXR1cm4gb2JqZWN0SWQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2FkQ2xhc3MoY2xhc3NOYW1lLCBzY2hlbWEpIHtcbiAgY29uc3QgYyA9IGdldE9yRWxzZShjbGFzc05hbWUsICgpID0+IG5ldyBQYXJzZUNsYXNzKGNsYXNzTmFtZSwgc2NoZW1hKSk7XG4gIGNvbnN0IG9iamVjdFR5cGUgPSBjLmdyYXBoUUxPYmplY3RUeXBlKCk7XG4gIGNvbnN0IGlucHV0VHlwZSA9IGMuZ3JhcGhRTElucHV0T2JqZWN0VHlwZSgpO1xuICBjb25zdCB1cGRhdGVUeXBlID0gYy5ncmFwaFFMVXBkYXRlSW5wdXRPYmplY3RUeXBlKCk7XG4gIGNvbnN0IHF1ZXJ5VHlwZSA9IGMuZ3JhcGhRTFF1ZXJ5SW5wdXRPYmplY3RUeXBlKCk7XG4gIGNvbnN0IHF1ZXJ5UmVzdWx0VHlwZSA9IGMuZ3JhcGhRTFF1ZXJ5UmVzdWx0VHlwZShvYmplY3RUeXBlKTtcbiAgY29uc3QgbXV0YXRpb25SZXN1bHRUeXBlID0gYy5ncmFwaFFMTXV0YXRpb25SZXN1bHRUeXBlKG9iamVjdFR5cGUpO1xuXG4gIGNvbnN0IGdldCA9IHtcbiAgICB0eXBlOiBvYmplY3RUeXBlLFxuICAgIGRlc2NyaXB0aW9uOiBgVXNlIHRoaXMgZW5kcG9pbnQgdG8gZ2V0IG9yIHF1ZXJ5ICR7Y2xhc3NOYW1lfSBvYmplY3RzYCxcbiAgICBhcmdzOiB7XG4gICAgICBvYmplY3RJZDogeyB0eXBlOiBuZXcgR3JhcGhRTE5vbk51bGwoR3JhcGhRTElEKSB9LFxuICAgIH0sXG4gICAgcmVzb2x2ZTogYXN5bmMgKHJvb3QsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcbiAgICAgIC8vIEdldCB0aGUgc2VsZWN0aW9uc1xuICAgICAgcmV0dXJuIGF3YWl0IHJ1bkdldChjb250ZXh0LCBpbmZvLCBjbGFzc05hbWUsIGFyZ3Mub2JqZWN0SWQsIHNjaGVtYSk7XG4gICAgfSxcbiAgfTtcblxuICBjb25zdCBmaW5kID0ge1xuICAgIHR5cGU6IHF1ZXJ5UmVzdWx0VHlwZSxcbiAgICBkZXNjcmlwdGlvbjogYFVzZSB0aGlzIGVuZHBvaW50IHRvIGdldCBvciBxdWVyeSAke2NsYXNzTmFtZX0gb2JqZWN0c2AsXG4gICAgYXJnczoge1xuICAgICAgd2hlcmU6IHsgdHlwZTogcXVlcnlUeXBlIH0sXG4gICAgICBmaXJzdDogeyB0eXBlOiBHcmFwaFFMSW50IH0sXG4gICAgICBsYXN0OiB7IHR5cGU6IEdyYXBoUUxJbnQgfSxcbiAgICAgIGFmdGVyOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICAgIGJlZm9yZTogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgfSxcbiAgICByZXNvbHZlOiBhc3luYyAocm9vdCwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xuICAgICAgLy8gR2V0IHRoZSBzZWxlY3Rpb25zXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgcnVuRmluZChjb250ZXh0LCBpbmZvLCBjbGFzc05hbWUsIGFyZ3MsIHNjaGVtYSk7XG4gICAgICByZXR1cm4gY29ubmVjdGlvblJlc3VsdHNBcnJheShyZXN1bHRzLCBhcmdzLCAxMDApO1xuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgY3JlYXRlID0ge1xuICAgIHR5cGU6IG11dGF0aW9uUmVzdWx0VHlwZSxcbiAgICBmaWVsZHM6IG9iamVjdFR5cGUuZmllbGRzLFxuICAgIGRlc2NyaXB0aW9uOiBgdXNlIHRoaXMgbWV0aG9kIHRvIGNyZWF0ZSBhIG5ldyAke2NsYXNzTmFtZX1gLFxuICAgIGFyZ3M6IHsgaW5wdXQ6IHsgdHlwZTogaW5wdXRUeXBlIH0gfSxcbiAgICByZXNvbHZlOiBhc3luYyAocm9vdCwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xuICAgICAgbGV0IHsgYXV0aCB9ID0gY29udGV4dDtcbiAgICAgIGNvbnN0IHsgY29uZmlnIH0gPSBjb250ZXh0O1xuICAgICAgY29uc3QgaW5wdXQgPSB0cmFuc2Zvcm1JbnB1dChhcmdzLmlucHV0LCBzY2hlbWFbY2xhc3NOYW1lXSk7XG4gICAgICBjb25zdCBjbGllbnRNdXRhdGlvbklkID0gaW5wdXQuY2xpZW50TXV0YXRpb25JZDtcbiAgICAgIGRlbGV0ZSBpbnB1dC5jbGllbnRNdXRhdGlvbklkO1xuICAgICAgYXdhaXQgaGFuZGxlRmlsZVVwbG9hZChjb25maWcsIGF1dGgsIGNsYXNzTmFtZSwgaW5wdXQsIHNjaGVtYSk7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCByZXN0LmNyZWF0ZShjb25maWcsIGF1dGgsIGNsYXNzTmFtZSwgaW5wdXQpO1xuICAgICAgaWYgKGNsYXNzTmFtZSA9PT0gJ19Vc2VyJyAmJiByZXMucmVzcG9uc2UgJiYgcmVzLnJlc3BvbnNlLnNlc3Npb25Ub2tlbikge1xuICAgICAgICBhdXRoID0gYXdhaXQgZ2V0QXV0aEZvclNlc3Npb25Ub2tlbih7XG4gICAgICAgICAgY29uZmlnLFxuICAgICAgICAgIGluc3RhbGxhdGlvbklkOiBjb250ZXh0LmluZm8gJiYgY29udGV4dC5pbmZvLmluc3RhbGxhdGlvbklkLFxuICAgICAgICAgIHNlc3Npb25Ub2tlbjogcmVzLnJlc3BvbnNlLnNlc3Npb25Ub2tlbixcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICAvLyBSdW4gZ2V0IHRvIG1hdGNoIGdyYXBoUUwgc3R5bGVcbiAgICAgIGNvbnN0IG9iamVjdCA9IGF3YWl0IHJ1bkdldChcbiAgICAgICAgeyBhdXRoLCBjb25maWcgfSxcbiAgICAgICAgaW5mbyxcbiAgICAgICAgY2xhc3NOYW1lLFxuICAgICAgICByZXMucmVzcG9uc2Uub2JqZWN0SWRcbiAgICAgICk7XG4gICAgICByZXR1cm4geyBvYmplY3QsIGNsaWVudE11dGF0aW9uSWQgfTtcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IHVwZGF0ZSA9IHtcbiAgICB0eXBlOiBtdXRhdGlvblJlc3VsdFR5cGUsXG4gICAgZGVzY3JpcHRpb246IGB1c2UgdGhpcyBtZXRob2QgdG8gdXBkYXRlIGFuIGV4aXN0aW5nICR7Y2xhc3NOYW1lfWAsXG4gICAgYXJnczoge1xuICAgICAgaW5wdXQ6IHsgdHlwZTogdXBkYXRlVHlwZSB9LFxuICAgIH0sXG4gICAgcmVzb2x2ZTogYXN5bmMgKHJvb3QsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcbiAgICAgIGNvbnN0IG9iamVjdElkID0gZ2V0T2JqZWN0SWQoYXJncy5pbnB1dCk7XG4gICAgICBjb25zdCBpbnB1dCA9IHRyYW5zZm9ybUlucHV0KGFyZ3MuaW5wdXQsIHNjaGVtYVtjbGFzc05hbWVdKTtcbiAgICAgIGNvbnN0IGNsaWVudE11dGF0aW9uSWQgPSBpbnB1dC5jbGllbnRNdXRhdGlvbklkO1xuICAgICAgZGVsZXRlIGlucHV0LmNsaWVudE11dGF0aW9uSWQ7XG4gICAgICBhd2FpdCBoYW5kbGVGaWxlVXBsb2FkKFxuICAgICAgICBjb250ZXh0LmNvbmZpZyxcbiAgICAgICAgY29udGV4dC5hdXRoLFxuICAgICAgICBjbGFzc05hbWUsXG4gICAgICAgIGlucHV0LFxuICAgICAgICBzY2hlbWFcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IHJlc3QudXBkYXRlKFxuICAgICAgICBjb250ZXh0LmNvbmZpZyxcbiAgICAgICAgY29udGV4dC5hdXRoLFxuICAgICAgICBjbGFzc05hbWUsXG4gICAgICAgIHsgb2JqZWN0SWQgfSxcbiAgICAgICAgaW5wdXRcbiAgICAgICk7XG4gICAgICAvLyBSdW4gZ2V0IHRvIG1hdGNoIGdyYXBoUUwgc3R5bGVcbiAgICAgIGNvbnN0IG9iamVjdCA9IGF3YWl0IHJ1bkdldChjb250ZXh0LCBpbmZvLCBjbGFzc05hbWUsIG9iamVjdElkKTtcbiAgICAgIHJldHVybiB7IG9iamVjdCwgY2xpZW50TXV0YXRpb25JZCB9O1xuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgZGVzdHJveSA9IHtcbiAgICB0eXBlOiBtdXRhdGlvblJlc3VsdFR5cGUsXG4gICAgZGVzY3JpcHRpb246IGB1c2UgdGhpcyBtZXRob2QgdG8gdXBkYXRlIGRlbGV0ZSBhbiBleGlzdGluZyAke2NsYXNzTmFtZX1gLFxuICAgIGFyZ3M6IHtcbiAgICAgIGlucHV0OiB7XG4gICAgICAgIHR5cGU6IG5ldyBHcmFwaFFMSW5wdXRPYmplY3RUeXBlKHtcbiAgICAgICAgICBuYW1lOiBgRGVzdHJveSR7Yy5kaXNwbGF5TmFtZX1JbnB1dGAsXG4gICAgICAgICAgZmllbGRzOiB7XG4gICAgICAgICAgICBpZDoge1xuICAgICAgICAgICAgICB0eXBlOiBHcmFwaFFMSUQsXG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVXNlIGVpdGhlciB0aGUgZ2xvYmFsIGlkIG9yIG9iamVjdElkJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvYmplY3RJZDoge1xuICAgICAgICAgICAgICB0eXBlOiBHcmFwaFFMSUQsXG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVXNlIGVpdGhlciB0aGUgZ2xvYmFsIGlkIG9yIG9iamVjdElkJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjbGllbnRNdXRhdGlvbklkOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICByZXNvbHZlOiBhc3luYyAocm9vdCwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xuICAgICAgY29uc3Qgb2JqZWN0SWQgPSBnZXRPYmplY3RJZChhcmdzLmlucHV0KTtcbiAgICAgIGNvbnN0IGNsaWVudE11dGF0aW9uSWQgPSBhcmdzLmlucHV0LmNsaWVudE11dGF0aW9uSWQ7XG4gICAgICBjb25zdCBvYmplY3QgPSBhd2FpdCBydW5HZXQoY29udGV4dCwgaW5mbywgY2xhc3NOYW1lLCBvYmplY3RJZCk7XG4gICAgICBhd2FpdCByZXN0LmRlbChjb250ZXh0LmNvbmZpZywgY29udGV4dC5hdXRoLCBjbGFzc05hbWUsIG9iamVjdElkKTtcbiAgICAgIHJldHVybiB7IG9iamVjdCwgY2xpZW50TXV0YXRpb25JZCB9O1xuICAgIH0sXG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBkaXNwbGF5TmFtZTogYy5kaXNwbGF5TmFtZSxcbiAgICBnZXQsXG4gICAgZmluZCxcbiAgICBjcmVhdGUsXG4gICAgdXBkYXRlLFxuICAgIGRlc3Ryb3ksXG4gICAgb2JqZWN0VHlwZSxcbiAgICBpbnB1dFR5cGUsXG4gICAgdXBkYXRlVHlwZSxcbiAgICBxdWVyeVR5cGUsXG4gICAgcXVlcnlSZXN1bHRUeXBlLFxuICAgIG11dGF0aW9uUmVzdWx0VHlwZSxcbiAgICBwYXJzZUNsYXNzOiBjLFxuICB9O1xufVxuXG5jb25zdCByZXNlcnZlZEZpZWxkTmFtZXMgPSBbJ29iamVjdElkJywgJ2NyZWF0ZWRBdCcsICd1cGRhdGVkQXQnXTtcblxuZXhwb3J0IGNsYXNzIFBhcnNlQ2xhc3Mge1xuICBzY2hlbWE7XG4gIGNsYXNzTmFtZTtcbiAgY2xhc3M7XG5cbiAgY29uc3RydWN0b3IoY2xhc3NOYW1lLCBzY2hlbWEpIHtcbiAgICB0aGlzLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcbiAgICB0aGlzLmRpc3BsYXlOYW1lID0gY2xhc3NOYW1lO1xuICAgIGlmICh0aGlzLmNsYXNzTmFtZS5pbmRleE9mKCdfJykgPT09IDApIHtcbiAgICAgIHRoaXMuZGlzcGxheU5hbWUgPSB0aGlzLmNsYXNzTmFtZS5zbGljZSgxKTtcbiAgICB9XG4gICAgdGhpcy5zY2hlbWEgPSBzY2hlbWE7XG4gICAgdGhpcy5jbGFzcyA9IHRoaXMuc2NoZW1hW2NsYXNzTmFtZV07XG4gICAgaWYgKCF0aGlzLmNsYXNzKSB7XG4gICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovXG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIGBBdHRlbXB0aW5nIHRvIGxvYWQgYSBjbGFzcyAoJHt0aGlzLmNsYXNzTmFtZX0pIHRoYXQgZG9lc24ndCBleGlzdC4uLmBcbiAgICAgICk7XG4gICAgICBjb25zb2xlLnRyYWNlKCk7XG4gICAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLWNvbnNvbGUgKi9cbiAgICB9XG4gIH1cblxuICBidWlsZEZpZWxkcyhtYXBwZXIsIGZpbHRlclJlc2VydmVkID0gZmFsc2UsIGlzT2JqZWN0ID0gZmFsc2UpIHtcbiAgICBpZiAoIXRoaXMuY2xhc3MpIHtcbiAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUgKi9cbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgYEF0dGVtcHRpbmcgdG8gYnVpbGQgZmllbGRzIGEgY2xhc3MgKCR7XG4gICAgICAgICAgdGhpcy5jbGFzc05hbWVcbiAgICAgICAgfSkgdGhhdCBkb2Vzbid0IGV4aXN0Li4uYFxuICAgICAgKTtcbiAgICAgIGNvbnNvbGUudHJhY2UoKTtcbiAgICAgIC8qIGVzbGludC1lbmFibGUgbm8tY29uc29sZSAqL1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBmaWVsZHMgPSB0aGlzLmNsYXNzLmZpZWxkcztcbiAgICBjb25zdCBpbml0aWFsID0ge307XG4gICAgaWYgKGlzT2JqZWN0KSB7XG4gICAgICBpbml0aWFsLmlkID0ge1xuICAgICAgICBkZXNjcmlwdGlvbjogJ0EgZ2xvYmFseSB1bmlxdWUgaWRlbnRpZmllci4nLFxuICAgICAgICB0eXBlOiBuZXcgR3JhcGhRTE5vbk51bGwoR3JhcGhRTElEKSxcbiAgICAgIH07XG4gICAgfVxuICAgIGlmICh0aGlzLmNsYXNzTmFtZSA9PT0gJ19Vc2VyJykge1xuICAgICAgaW5pdGlhbC5zZXNzaW9uVG9rZW4gPSB7XG4gICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICdUaGUgc2Vzc2lvbiB0b2tlbiBmb3IgdGhlIHVzZXIsIHNldCBvbmx5IHdoZW4gaXQgbWFrZXMgc2Vuc2UuJyxcbiAgICAgICAgdHlwZTogR3JhcGhRTFN0cmluZyxcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBPYmplY3Qua2V5cyhmaWVsZHMpLnJlZHVjZSgobWVtbywgZmllbGROYW1lKSA9PiB7XG4gICAgICBpZiAoZmlsdGVyUmVzZXJ2ZWQgJiYgcmVzZXJ2ZWRGaWVsZE5hbWVzLmluZGV4T2YoZmllbGROYW1lKSA+PSAwKSB7XG4gICAgICAgIHJldHVybiBtZW1vO1xuICAgICAgfVxuICAgICAgY29uc3QgZmllbGQgPSBmaWVsZHNbZmllbGROYW1lXTtcbiAgICAgIGNvbnN0IGdRTEZpZWxkID0gbWFwcGVyKGZpZWxkTmFtZSwgZmllbGQsIHRoaXMuc2NoZW1hKTtcbiAgICAgIGlmICghZ1FMRmllbGQpIHtcbiAgICAgICAgcmV0dXJuIG1lbW87XG4gICAgICB9XG4gICAgICBtZW1vW2ZpZWxkTmFtZV0gPSBnUUxGaWVsZDtcbiAgICAgIHJldHVybiBtZW1vO1xuICAgIH0sIGluaXRpYWwpO1xuICB9XG5cbiAgaXNUeXBlT2Yob2JqZWN0KSB7XG4gICAgcmV0dXJuIG9iamVjdC5jbGFzc05hbWUgPT09IHRoaXMuY2xhc3NOYW1lO1xuICB9XG5cbiAgZ3JhcGhRTENvbmZpZygpIHtcbiAgICBjb25zdCBjbGFzc05hbWUgPSB0aGlzLmNsYXNzTmFtZTtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogdGhpcy5kaXNwbGF5TmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiBgUGFyc2UgQ2xhc3MgJHtjbGFzc05hbWV9YCxcbiAgICAgIC8vIGluIHJlbGF5LCBpdCdzIGltcG9zc2libGUgdG8gaGF2ZSAyIGludGVyZmFjZXM/Pz9cbiAgICAgIGludGVyZmFjZXM6IFtOb2RlIC8qIFBhcnNlT2JqZWN0SW50ZXJmYWNlICovXSxcbiAgICAgIGZpZWxkczogKCkgPT4gdGhpcy5idWlsZEZpZWxkcyhncmFwaFFMRmllbGQsIGZhbHNlLCB0cnVlKSxcbiAgICAgIGlzVHlwZU9mOiB0aGlzLmlzVHlwZU9mLmJpbmQodGhpcyksXG4gICAgfTtcbiAgfVxuXG4gIGdyYXBoUUxRdWVyeUNvbmZpZygpIHtcbiAgICBjb25zdCBjbGFzc05hbWUgPSB0aGlzLmNsYXNzTmFtZTtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogdGhpcy5kaXNwbGF5TmFtZSArICdRdWVyeScsXG4gICAgICBkZXNjcmlwdGlvbjogYFBhcnNlIENsYXNzICR7Y2xhc3NOYW1lfSBRdWVyeWAsXG4gICAgICBmaWVsZHM6ICgpID0+IHtcbiAgICAgICAgY29uc3QgZmllbGRzID0gdGhpcy5idWlsZEZpZWxkcyhncmFwaFFMUXVlcnlGaWVsZCk7XG4gICAgICAgIGRlbGV0ZSBmaWVsZHMub2JqZWN0SWQ7XG4gICAgICAgIGRlbGV0ZSBmaWVsZHMuaWQ7XG4gICAgICAgIHJldHVybiBmaWVsZHM7XG4gICAgICB9LFxuICAgICAgaXNUeXBlT2Y6IHRoaXMuaXNUeXBlT2YuYmluZCh0aGlzKSxcbiAgICB9O1xuICB9XG5cbiAgZ3JhcGhRTElucHV0Q29uZmlnKCkge1xuICAgIGNvbnN0IGNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lO1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBgQWRkJHt0aGlzLmRpc3BsYXlOYW1lfUlucHV0YCxcbiAgICAgIGRlc2NyaXB0aW9uOiBgUGFyc2UgQ2xhc3MgJHtjbGFzc05hbWV9IElucHV0YCxcbiAgICAgIGZpZWxkczogKCkgPT4ge1xuICAgICAgICBjb25zdCBmaWVsZHMgPSB0aGlzLmJ1aWxkRmllbGRzKGdyYXBoUUxJbnB1dEZpZWxkLCB0cnVlKTtcbiAgICAgICAgZmllbGRzLmNsaWVudE11dGF0aW9uSWQgPSB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfTtcbiAgICAgICAgcmV0dXJuIGZpZWxkcztcbiAgICAgIH0sXG4gICAgICBpc1R5cGVPZjogdGhpcy5pc1R5cGVPZi5iaW5kKHRoaXMpLFxuICAgIH07XG4gIH1cblxuICBncmFwaFFMVXBkYXRlSW5wdXRDb25maWcoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IGBVcGRhdGUke3RoaXMuZGlzcGxheU5hbWV9SW5wdXRgLFxuICAgICAgZGVzY3JpcHRpb246IGBQYXJzZSBDbGFzcyAke3RoaXMuY2xhc3NOYW1lfSBVcGRhdGVgLFxuICAgICAgZmllbGRzOiAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGZpZWxkcyA9IHRoaXMuYnVpbGRGaWVsZHMoZ3JhcGhRTElucHV0RmllbGQsIHRydWUpO1xuICAgICAgICBmaWVsZHMuaWQgPSB7IHR5cGU6IEdyYXBoUUxJRCB9O1xuICAgICAgICBmaWVsZHMub2JqZWN0SWQgPSB7IHR5cGU6IEdyYXBoUUxJRCB9O1xuICAgICAgICBmaWVsZHMuY2xpZW50TXV0YXRpb25JZCA9IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9O1xuICAgICAgICByZXR1cm4gZmllbGRzO1xuICAgICAgfSxcbiAgICAgIGlzVHlwZU9mOiB0aGlzLmlzVHlwZU9mLmJpbmQodGhpcyksXG4gICAgfTtcbiAgfVxuXG4gIGdyYXBoUUxRdWVyeVJlc3VsdENvbmZpZygpIHtcbiAgICBjb25zdCBvYmplY3RUeXBlID0gdGhpcy5ncmFwaFFMT2JqZWN0VHlwZSgpO1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBgJHt0aGlzLmRpc3BsYXlOYW1lfVF1ZXJ5Q29ubmVjdGlvbmAsXG4gICAgICBmaWVsZHM6IHtcbiAgICAgICAgbm9kZXM6IHsgdHlwZTogbmV3IEdyYXBoUUxMaXN0KG9iamVjdFR5cGUpIH0sXG4gICAgICAgIGVkZ2VzOiB7XG4gICAgICAgICAgdHlwZTogbmV3IEdyYXBoUUxMaXN0KFxuICAgICAgICAgICAgbmV3IEdyYXBoUUxPYmplY3RUeXBlKHtcbiAgICAgICAgICAgICAgbmFtZTogYCR7dGhpcy5kaXNwbGF5TmFtZX1FZGdlYCxcbiAgICAgICAgICAgICAgZmllbGRzOiAoKSA9PiAoe1xuICAgICAgICAgICAgICAgIG5vZGU6IHsgdHlwZTogb2JqZWN0VHlwZSB9LFxuICAgICAgICAgICAgICAgIGN1cnNvcjogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICApLFxuICAgICAgICB9LFxuICAgICAgICBwYWdlSW5mbzogeyB0eXBlOiBQYWdlSW5mbyB9LFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgZ3JhcGhRTE11dGF0aW9uUmVzdWx0Q29uZmlnKCkge1xuICAgIGNvbnN0IG9iamVjdFR5cGUgPSB0aGlzLmdyYXBoUUxPYmplY3RUeXBlKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IGAke3RoaXMuZGlzcGxheU5hbWV9TXV0YXRpb25Db21wbGV0ZVBheWxvYWRgLFxuICAgICAgZmllbGRzOiB7XG4gICAgICAgIG9iamVjdDogeyB0eXBlOiBvYmplY3RUeXBlIH0sXG4gICAgICAgIGNsaWVudE11dGF0aW9uSWQ6IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgZ3JhcGhRTE9iamVjdFR5cGUoKSB7XG4gICAgaWYgKCF0aGlzLm9iamVjdFR5cGUpIHtcbiAgICAgIHRoaXMub2JqZWN0VHlwZSA9IG5ldyBHcmFwaFFMT2JqZWN0VHlwZSh0aGlzLmdyYXBoUUxDb25maWcoKSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLm9iamVjdFR5cGU7XG4gIH1cblxuICBncmFwaFFMVXBkYXRlSW5wdXRPYmplY3RUeXBlKCkge1xuICAgIGlmICghdGhpcy51cGRhdGVJbnB1dE9iamVjdFR5cGUpIHtcbiAgICAgIHRoaXMudXBkYXRlSW5wdXRPYmplY3RUeXBlID0gbmV3IEdyYXBoUUxJbnB1dE9iamVjdFR5cGUoXG4gICAgICAgIHRoaXMuZ3JhcGhRTFVwZGF0ZUlucHV0Q29uZmlnKClcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnVwZGF0ZUlucHV0T2JqZWN0VHlwZTtcbiAgfVxuXG4gIGdyYXBoUUxJbnB1dE9iamVjdFR5cGUoKSB7XG4gICAgaWYgKCF0aGlzLmlucHV0T2JqZWN0VHlwZSkge1xuICAgICAgdGhpcy5pbnB1dE9iamVjdFR5cGUgPSBuZXcgR3JhcGhRTElucHV0T2JqZWN0VHlwZShcbiAgICAgICAgdGhpcy5ncmFwaFFMSW5wdXRDb25maWcoKVxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuaW5wdXRPYmplY3RUeXBlO1xuICB9XG5cbiAgZ3JhcGhRTFF1ZXJ5SW5wdXRPYmplY3RUeXBlKCkge1xuICAgIGlmICghdGhpcy5xdWVyeUlucHV0T2JqZWN0VHlwZSkge1xuICAgICAgdGhpcy5xdWVyeUlucHV0T2JqZWN0VHlwZSA9IG5ldyBHcmFwaFFMSW5wdXRPYmplY3RUeXBlKFxuICAgICAgICB0aGlzLmdyYXBoUUxRdWVyeUNvbmZpZygpXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5xdWVyeUlucHV0T2JqZWN0VHlwZTtcbiAgfVxuXG4gIGdyYXBoUUxRdWVyeVJlc3VsdFR5cGUoKSB7XG4gICAgaWYgKCF0aGlzLnF1ZXJ5UmVzdWx0T2JqZWN0VHlwZSkge1xuICAgICAgdGhpcy5xdWVyeVJlc3VsdE9iamVjdFR5cGUgPSBuZXcgR3JhcGhRTE9iamVjdFR5cGUoXG4gICAgICAgIHRoaXMuZ3JhcGhRTFF1ZXJ5UmVzdWx0Q29uZmlnKClcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnF1ZXJ5UmVzdWx0T2JqZWN0VHlwZTtcbiAgfVxuXG4gIGdyYXBoUUxNdXRhdGlvblJlc3VsdFR5cGUoKSB7XG4gICAgaWYgKCF0aGlzLm11dGF0aW9uUmVzdWx0T2JqZWN0VHlwZSkge1xuICAgICAgdGhpcy5tdXRhdGlvblJlc3VsdE9iamVjdFR5cGUgPSBuZXcgR3JhcGhRTE9iamVjdFR5cGUoXG4gICAgICAgIHRoaXMuZ3JhcGhRTE11dGF0aW9uUmVzdWx0Q29uZmlnKClcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLm11dGF0aW9uUmVzdWx0T2JqZWN0VHlwZTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UGFyc2VDbGFzc1F1ZXJ5RmllbGRzKHNjaGVtYSkge1xuICByZXR1cm4gc2NoZW1hLl9fY2xhc3NOYW1lcy5yZWR1Y2UoKGZpZWxkcywgY2xhc3NOYW1lKSA9PiB7XG4gICAgY29uc3QgeyBnZXQsIGZpbmQsIGRpc3BsYXlOYW1lIH0gPSBsb2FkQ2xhc3MoY2xhc3NOYW1lLCBzY2hlbWEpO1xuICAgIHJldHVybiBPYmplY3QuYXNzaWduKGZpZWxkcywge1xuICAgICAgW2Rpc3BsYXlOYW1lXTogZ2V0LFxuICAgICAgW2BmaW5kJHtkaXNwbGF5TmFtZX1gXTogZmluZCxcbiAgICB9KTtcbiAgfSwge30pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UGFyc2VDbGFzc011dGF0aW9uRmllbGRzKHNjaGVtYSkge1xuICByZXR1cm4gc2NoZW1hLl9fY2xhc3NOYW1lcy5yZWR1Y2UoKGZpZWxkcywgY2xhc3NOYW1lKSA9PiB7XG4gICAgY29uc3QgeyBjcmVhdGUsIHVwZGF0ZSwgZGVzdHJveSwgZGlzcGxheU5hbWUgfSA9IGxvYWRDbGFzcyhcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIHNjaGVtYVxuICAgICk7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oZmllbGRzLCB7XG4gICAgICBbYGFkZCR7ZGlzcGxheU5hbWV9YF06IGNyZWF0ZSxcbiAgICAgIFtgdXBkYXRlJHtkaXNwbGF5TmFtZX1gXTogdXBkYXRlLFxuICAgICAgW2BkZXN0cm95JHtkaXNwbGF5TmFtZX1gXTogZGVzdHJveSxcbiAgICB9KTtcbiAgfSwge30pO1xufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIFF1ZXJ5OiBnZXRQYXJzZUNsYXNzUXVlcnlGaWVsZHMsXG4gIE11dGF0aW9uOiBnZXRQYXJzZUNsYXNzTXV0YXRpb25GaWVsZHMsXG59O1xuIl19